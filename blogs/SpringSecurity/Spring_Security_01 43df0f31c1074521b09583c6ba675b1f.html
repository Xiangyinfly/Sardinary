<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringSecurityæºç è§£æ-1 | Sardinary&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content=" ">
    
    <link rel="preload" href="/Sardinary/assets/css/0.styles.cca88062.css" as="style"><link rel="preload" href="/Sardinary/assets/js/app.b4352b80.js" as="script"><link rel="preload" href="/Sardinary/assets/js/7.1de0e771.js" as="script"><link rel="preload" href="/Sardinary/assets/js/2.32e86603.js" as="script"><link rel="preload" href="/Sardinary/assets/js/1.87af8fda.js" as="script"><link rel="preload" href="/Sardinary/assets/js/19.73412c71.js" as="script"><link rel="prefetch" href="/Sardinary/assets/js/10.49a810cd.js"><link rel="prefetch" href="/Sardinary/assets/js/11.7175f7e3.js"><link rel="prefetch" href="/Sardinary/assets/js/14.a5477566.js"><link rel="prefetch" href="/Sardinary/assets/js/15.439772b1.js"><link rel="prefetch" href="/Sardinary/assets/js/16.16e886bc.js"><link rel="prefetch" href="/Sardinary/assets/js/17.0e6e36bb.js"><link rel="prefetch" href="/Sardinary/assets/js/18.5e148afa.js"><link rel="prefetch" href="/Sardinary/assets/js/20.e6e484b2.js"><link rel="prefetch" href="/Sardinary/assets/js/21.7c59eb62.js"><link rel="prefetch" href="/Sardinary/assets/js/22.1a4515f8.js"><link rel="prefetch" href="/Sardinary/assets/js/23.77f49651.js"><link rel="prefetch" href="/Sardinary/assets/js/24.2978efd9.js"><link rel="prefetch" href="/Sardinary/assets/js/25.c67021f4.js"><link rel="prefetch" href="/Sardinary/assets/js/26.6879f189.js"><link rel="prefetch" href="/Sardinary/assets/js/27.a2713265.js"><link rel="prefetch" href="/Sardinary/assets/js/28.0e7ec6a5.js"><link rel="prefetch" href="/Sardinary/assets/js/29.b33743d7.js"><link rel="prefetch" href="/Sardinary/assets/js/3.5b666661.js"><link rel="prefetch" href="/Sardinary/assets/js/30.3b66f6c0.js"><link rel="prefetch" href="/Sardinary/assets/js/31.a9a2ab1e.js"><link rel="prefetch" href="/Sardinary/assets/js/32.14ad86fd.js"><link rel="prefetch" href="/Sardinary/assets/js/33.1afd794c.js"><link rel="prefetch" href="/Sardinary/assets/js/34.31730445.js"><link rel="prefetch" href="/Sardinary/assets/js/35.acb79716.js"><link rel="prefetch" href="/Sardinary/assets/js/36.f161e3da.js"><link rel="prefetch" href="/Sardinary/assets/js/37.164bb569.js"><link rel="prefetch" href="/Sardinary/assets/js/38.0e4326d9.js"><link rel="prefetch" href="/Sardinary/assets/js/39.c0cdc477.js"><link rel="prefetch" href="/Sardinary/assets/js/4.95ecc938.js"><link rel="prefetch" href="/Sardinary/assets/js/40.4c8a03a6.js"><link rel="prefetch" href="/Sardinary/assets/js/41.b3e26267.js"><link rel="prefetch" href="/Sardinary/assets/js/42.6526990c.js"><link rel="prefetch" href="/Sardinary/assets/js/43.237a07a2.js"><link rel="prefetch" href="/Sardinary/assets/js/44.20a80a6c.js"><link rel="prefetch" href="/Sardinary/assets/js/45.ee53ec88.js"><link rel="prefetch" href="/Sardinary/assets/js/46.55f62d10.js"><link rel="prefetch" href="/Sardinary/assets/js/47.2a4b0a3b.js"><link rel="prefetch" href="/Sardinary/assets/js/48.d2f40143.js"><link rel="prefetch" href="/Sardinary/assets/js/49.6f809adc.js"><link rel="prefetch" href="/Sardinary/assets/js/5.c87bfc3b.js"><link rel="prefetch" href="/Sardinary/assets/js/50.e8110b40.js"><link rel="prefetch" href="/Sardinary/assets/js/51.e5d33d8f.js"><link rel="prefetch" href="/Sardinary/assets/js/52.35081e55.js"><link rel="prefetch" href="/Sardinary/assets/js/53.f148b50f.js"><link rel="prefetch" href="/Sardinary/assets/js/54.c9fddbbe.js"><link rel="prefetch" href="/Sardinary/assets/js/55.3bf482f3.js"><link rel="prefetch" href="/Sardinary/assets/js/56.284247d8.js"><link rel="prefetch" href="/Sardinary/assets/js/57.cd2fa388.js"><link rel="prefetch" href="/Sardinary/assets/js/58.9717d8f3.js"><link rel="prefetch" href="/Sardinary/assets/js/59.387411ca.js"><link rel="prefetch" href="/Sardinary/assets/js/6.363116dc.js"><link rel="prefetch" href="/Sardinary/assets/js/60.10700fc9.js"><link rel="prefetch" href="/Sardinary/assets/js/61.37f12cd5.js"><link rel="prefetch" href="/Sardinary/assets/js/62.1ee2e76e.js"><link rel="prefetch" href="/Sardinary/assets/js/63.05cc0dee.js"><link rel="prefetch" href="/Sardinary/assets/js/64.2eefe5c7.js"><link rel="prefetch" href="/Sardinary/assets/js/65.57aedaf0.js"><link rel="prefetch" href="/Sardinary/assets/js/66.3362b95c.js"><link rel="prefetch" href="/Sardinary/assets/js/67.31c9d9fd.js"><link rel="prefetch" href="/Sardinary/assets/js/68.966d4fa1.js"><link rel="prefetch" href="/Sardinary/assets/js/69.a33abe62.js"><link rel="prefetch" href="/Sardinary/assets/js/70.11dd9007.js"><link rel="prefetch" href="/Sardinary/assets/js/71.8006b388.js"><link rel="prefetch" href="/Sardinary/assets/js/72.73f1646b.js"><link rel="prefetch" href="/Sardinary/assets/js/73.f53d7f97.js"><link rel="prefetch" href="/Sardinary/assets/js/74.db2bf712.js"><link rel="prefetch" href="/Sardinary/assets/js/8.1ffd42bb.js"><link rel="prefetch" href="/Sardinary/assets/js/9.8e14a092.js"><link rel="prefetch" href="/Sardinary/assets/js/vendors~docsearch.34a230bb.js">
    <link rel="stylesheet" href="/Sardinary/assets/css/0.styles.cca88062.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Sardinary's Blog</h3> <p class="description" data-v-59e6cb88> </p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Sardinary Chen</span>
        Â Â 
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Sardinary/" class="home-link router-link-active"><img src="/Sardinary/avatar.jpg" alt="Sardinary's Blog" class="logo"> <span class="site-name">Sardinary's Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Sardinary/" class="nav-link"><i class="undefined"></i>
  ğŸ 
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Sardinary/categories/åç«¯/" class="nav-link"><i class="undefined"></i>
  åç«¯
</a></li><li class="dropdown-item"><!----> <a href="/Sardinary/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/Sardinary/categories/ä¸­é—´ä»¶/" class="nav-link"><i class="undefined"></i>
  ä¸­é—´ä»¶
</a></li></ul></div></div><div class="nav-item"><a href="/Sardinary/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Sardinary ğŸˆ
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Xiangyinfly" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/Sardinary/avatar.jpg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    Sardinary Chen
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>36</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>12</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/Sardinary/" class="nav-link"><i class="undefined"></i>
  ğŸ 
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Sardinary/categories/åç«¯/" class="nav-link"><i class="undefined"></i>
  åç«¯
</a></li><li class="dropdown-item"><!----> <a href="/Sardinary/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/Sardinary/categories/ä¸­é—´ä»¶/" class="nav-link"><i class="undefined"></i>
  ä¸­é—´ä»¶
</a></li></ul></div></div><div class="nav-item"><a href="/Sardinary/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Sardinary ğŸˆ
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Xiangyinfly" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>SpringSecurityæºç è§£æ-1</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Sardinary Chen</span>
        Â Â 
        <!---->
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">SpringSecurityæºç è§£æ-1</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>Sardinary Chen</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2/26/2024</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>SpringSecurity</span><span class="tag-item" data-v-8a445198>æºç è§£æ</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="spring-security-01"><a href="#spring-security-01" class="header-anchor">#</a> Spring_Security_01</h1> <h1 id="springsecurityçš„é¡¶å±‚è„‰ç»œä»¥åŠå‡ ä¸ªæ ¸å¿ƒçš„ç±»"><a href="#springsecurityçš„é¡¶å±‚è„‰ç»œä»¥åŠå‡ ä¸ªæ ¸å¿ƒçš„ç±»" class="header-anchor">#</a> SpringSecurityçš„é¡¶å±‚è„‰ç»œä»¥åŠå‡ ä¸ªæ ¸å¿ƒçš„ç±»</h1> <ul><li>SecurityBuilder</li> <li>HttpSecurity</li> <li>WebSecurity</li> <li>SecurityFilterChain</li> <li>FilterChainProxy</li></ul> <h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="header-anchor">#</a> å¼•å…¥</h2> <p>WebSecurityConfigurerAdapterå¼ƒç”¨ï¼Œé€šè¿‡é…ç½®beanæ¥é…ç½®HttpSecurityå’ŒWebSecurity</p> <div class="language- extra-class"><pre class="language-text"><code>Use a org.springframework.security.web.SecurityFilterChain Bean to configure HttpSecurity or a WebSecurityCustomizer Bean to configure WebSecurity

</code></pre></div><p>HttpSecurityå’ŒWebSecurityéƒ½å®ç°äº†SecurityBuilderï¼Œç”¨æ¥æ„å»ºå¯¹è±¡</p> <div class="language- extra-class"><pre class="language-text"><code>public interface SecurityBuilder&lt;O&gt; {
	O build() throws Exception;
}

</code></pre></div><h2 id="httpsecurity"><a href="#httpsecurity" class="header-anchor">#</a> HttpSecurity</h2> <p><img src="/Sardinary/assets/img/Untitled.187f63dc.png" alt="Untitled"></p> <div class="language- extra-class"><pre class="language-text"><code>public final class HttpSecurity
	extends AbstractConfiguredSecurityBuilder&lt;DefaultSecurityFilterChain, HttpSecurity&gt;
	implements SecurityBuilder&lt;DefaultSecurityFilterChain&gt;,HttpSecurityBuilder&lt;HttpSecurity&gt;{}

</code></pre></div><blockquote><p><code>implements SecurityBuilder&lt;DefaultSecurityFilterChain&gt;</code>ï¼š</p> <p>HttpSecurityçš„æ³›å‹Oä¸ºDefaultSecurityFilterChainï¼Œå³ä¸ºäº†æ„å»ºDefaultSecurityFilterChain</p></blockquote> <h3 id="securityfilterchain"><a href="#securityfilterchain" class="header-anchor">#</a> SecurityFilterChain</h3> <div class="language- extra-class"><pre class="language-text"><code>public interface SecurityFilterChain {
	//å¦‚æœè¿”å›trueï¼Œå°±ä¼šå¯¹requeståº”ç”¨listé‡Œçš„è¿‡æ»¤å™¨
    boolean matches(HttpServletRequest request);

    List&lt;Filter&gt; getFilters();

}

</code></pre></div><h3 id="å®ç°ç±»defaultsecurityfilterchain"><a href="#å®ç°ç±»defaultsecurityfilterchain" class="header-anchor">#</a> å®ç°ç±»DefaultSecurityFilterChain</h3> <p><img src="/Sardinary/assets/img/Untitled1.7ee65abb.png" alt="Untitled"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSecurityFilterChain</span> <span class="token keyword">implements</span> <span class="token class-name">SecurityFilterChain</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Log</span> logger <span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token class-name">DefaultSecurityFilterChain</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RequestMatcher</span> requestMatcher<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Filter</span><span class="token punctuation">&gt;</span></span> filters<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DefaultSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">RequestMatcher</span> requestMatcher<span class="token punctuation">,</span> <span class="token class-name">Filter</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> filters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">(</span>requestMatcher<span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>filters<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">DefaultSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">RequestMatcher</span> requestMatcher<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Filter</span><span class="token punctuation">&gt;</span></span> filters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>filters<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Will not secure %s&quot;</span><span class="token punctuation">,</span> requestMatcher<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">else</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Will secure %s with %s&quot;</span><span class="token punctuation">,</span> requestMatcher<span class="token punctuation">,</span> filters<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>requestMatcher <span class="token operator">=</span> requestMatcher<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>filters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>filters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">RequestMatcher</span> <span class="token function">getRequestMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requestMatcher<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Filter</span><span class="token punctuation">&gt;</span></span> <span class="token function">getFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//åŒ¹é…æˆåŠŸå°±ä¼šåº”ç”¨filtersé‡Œçš„è¿‡æ»¤å™¨</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requestMatcher<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; [RequestMatcher=&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requestMatcher <span class="token operator">+</span> <span class="token string">&quot;, Filters=&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filters
             <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h2 id="websecurity"><a href="#websecurity" class="header-anchor">#</a> WebSecurity</h2> <p><img src="/Sardinary/assets/img/Untitled2.d23f9224.png" alt="Untitled"></p> <div class="language- extra-class"><pre class="language-text"><code>public final class WebSecurity
	extends AbstractConfiguredSecurityBuilder&lt;Filter, WebSecurity&gt;
	implements SecurityBuilder&lt;Filter&gt;, ApplicationContextAware, ServletContextAware {}

</code></pre></div><p><code>implements SecurityBuilder&lt;Filter&gt;</code>:WebSecurityçš„æ³›å‹Oä¸ºFilterï¼Œå³ä¸ºäº†æ„å»ºFilter</p> <h3 id="securitybuilderçš„buildæ–¹æ³•-dobuildæ–¹æ³•"><a href="#securitybuilderçš„buildæ–¹æ³•-dobuildæ–¹æ³•" class="header-anchor">#</a> SecurityBuilderçš„buildæ–¹æ³• -&gt; doBuildæ–¹æ³•</h3> <div class="language- extra-class"><pre class="language-text"><code>protected final O doBuild() throws Exception {
    synchronized (this.configurers) {
       this.buildState = BuildState.INITIALIZING;
       beforeInit();
       init();
       this.buildState = BuildState.CONFIGURING;
       beforeConfigure();
       configure();
       this.buildState = BuildState.BUILDING;
       O result = performBuild();
       this.buildState = BuildState.BUILT;
       return result;
    }
}

</code></pre></div><p>å…¶ä¸­æœ‰äº›æ–¹æ³•ä¸æ˜¯abstractï¼Œè¯´æ˜è¿™äº›æ–¹æ³•ä¸é‡è¦ï¼Œå­ç±»ä¸éœ€è¦é‡å†™ï¼ˆabstractçš„æ–¹æ³•å¿…é¡»å®ç°ï¼‰</p> <p>ç”±ä»£ç å¯è§é€šè¿‡<strong>performBuild</strong>æ–¹æ³•æ„å»ºäº†resultå¯¹è±¡</p> <p>performBuildæ–¹æ³•æœ‰ä¸‰ä¸ªå®ç°ç±»ï¼Œå…¶ä¸­åŒ…æ‹¬ç†Ÿæ‚‰çš„HttpSecurityå’ŒWebSecurity</p> <blockquote><p>åœ¨HttpSecurityä¸­ï¼Œè¯¥æ–¹æ³• return new DefaultSecurityFilterChain(this.requestMatcher, sortedFilters);</p></blockquote> <blockquote><p>åœ¨WebSecurityä¸­ï¼Œè¯¥æ–¹æ³•è¿”å›äº†ä¸€ä¸ªÂ FilterChainProxy</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Filter</span> <span class="token function">performBuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>securityFilterChainBuilders<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;At least one SecurityBuilder&lt;? extends SecurityFilterChain&gt; needs to be specified. &quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;Typically this is done by exposing a SecurityFilterChain bean. &quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;More advanced users can invoke &quot;</span> <span class="token operator">+</span> <span class="token class-name">WebSecurity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">+</span> <span class="token string">&quot;.addSecurityFilterChainBuilder directly&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> chainSize <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ignoredRequests<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>securityFilterChainBuilders<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityFilterChain</span><span class="token punctuation">&gt;</span></span> securityFilterChains <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>chainSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RequestMatcherEntry</span><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">WebInvocationPrivilegeEvaluator</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> requestMatcherPrivilegeEvaluatorsEntries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RequestMatcher</span> ignoredRequest <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ignoredRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">WebSecurity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;You are asking Spring Security to ignore &quot;</span> <span class="token operator">+</span> ignoredRequest
             <span class="token operator">+</span> <span class="token string">&quot;. This is not recommended -- please use permitAll via HttpSecurity#authorizeHttpRequests instead.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">SecurityFilterChain</span> securityFilterChain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSecurityFilterChain</span><span class="token punctuation">(</span>ignoredRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
       securityFilterChains<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>securityFilterChain<span class="token punctuation">)</span><span class="token punctuation">;</span>
       requestMatcherPrivilegeEvaluatorsEntries
          <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">getRequestMatcherPrivilegeEvaluatorsEntry</span><span class="token punctuation">(</span>securityFilterChain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SecurityBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">SecurityFilterChain</span><span class="token punctuation">&gt;</span></span> securityFilterChainBuilder <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>securityFilterChainBuilders<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">SecurityFilterChain</span> securityFilterChain <span class="token operator">=</span> securityFilterChainBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       securityFilterChains<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>securityFilterChain<span class="token punctuation">)</span><span class="token punctuation">;</span>
       requestMatcherPrivilegeEvaluatorsEntries
          <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">getRequestMatcherPrivilegeEvaluatorsEntry</span><span class="token punctuation">(</span>securityFilterChain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>privilegeEvaluator <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>privilegeEvaluator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RequestMatcherDelegatingWebInvocationPrivilegeEvaluator</span><span class="token punctuation">(</span>
             requestMatcherPrivilegeEvaluatorsEntries<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">FilterChainProxy</span> filterChainProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterChainProxy</span><span class="token punctuation">(</span>securityFilterChains<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>httpFirewall <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       filterChainProxy<span class="token punctuation">.</span><span class="token function">setFirewall</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>httpFirewall<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>requestRejectedHandler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       filterChainProxy<span class="token punctuation">.</span><span class="token function">setRequestRejectedHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>requestRejectedHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>observationRegistry<span class="token punctuation">.</span><span class="token function">isNoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">CompositeRequestRejectedHandler</span> requestRejectedHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompositeRequestRejectedHandler</span><span class="token punctuation">(</span>
             <span class="token keyword">new</span> <span class="token class-name">ObservationMarkingRequestRejectedHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>observationRegistry<span class="token punctuation">)</span><span class="token punctuation">,</span>
             <span class="token keyword">new</span> <span class="token class-name">HttpStatusRequestRejectedHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       filterChainProxy<span class="token punctuation">.</span><span class="token function">setRequestRejectedHandler</span><span class="token punctuation">(</span>requestRejectedHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    filterChainProxy<span class="token punctuation">.</span><span class="token function">setFilterChainDecorator</span><span class="token punctuation">(</span><span class="token function">getFilterChainDecorator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filterChainProxy<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Filter</span> result <span class="token operator">=</span> filterChainProxy<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debugEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;\n\n&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;********************************************************************\n&quot;</span>
             <span class="token operator">+</span> <span class="token string">&quot;**********        Security debugging is enabled.       *************\n&quot;</span>
             <span class="token operator">+</span> <span class="token string">&quot;**********    This may include sensitive information.  *************\n&quot;</span>
             <span class="token operator">+</span> <span class="token string">&quot;**********      Do not use in a production system!     *************\n&quot;</span>
             <span class="token operator">+</span> <span class="token string">&quot;********************************************************************\n\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DebugFilter</span><span class="token punctuation">(</span>filterChainProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>postBuildAction<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>WebSecurityçš„buildæ–¹æ³•ç”±<a href="https://sardinary.vercel.app/spring/spring-security-02/#web-security-configuration" target="_blank" rel="noopener noreferrer">WebSecurityConfiguration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>è°ƒç”¨</p> <h3 id="filterchainproxy"><a href="#filterchainproxy" class="header-anchor">#</a> FilterChainProxy</h3> <p><img src="/Sardinary/assets/img/Untitled3.e5f486af.png" alt="Untitled"></p> <p>å…¶æ„é€ æ–¹æ³•ä¼ å…¥äº†<a href="https://sardinary.vercel.app/spring/spring-security-01/#security-filter-chain" target="_blank" rel="noopener noreferrer">SecurityFilterChain<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„é›†åˆ</p> <div class="language- extra-class"><pre class="language-text"><code>public FilterChainProxy(List&lt;SecurityFilterChain&gt; filterChains) {
    this.filterChains = filterChains;
}

</code></pre></div><p>å…¶ä¸­doFilteræ–¹æ³• -&gt; doFilterInternalæ–¹æ³•</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>
       <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> clearContext <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">FILTER_APPLIED</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>clearContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">doFilterInternal</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
       request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token constant">FILTER_APPLIED</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">doFilterInternal</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">Throwable</span><span class="token punctuation">[</span><span class="token punctuation">]</span> causeChain <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throwableAnalyzer<span class="token punctuation">.</span><span class="token function">determineCauseChain</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">Throwable</span> requestRejectedException <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throwableAnalyzer
          <span class="token punctuation">.</span><span class="token function">getFirstThrowableOfType</span><span class="token punctuation">(</span><span class="token class-name">RequestRejectedException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> causeChain<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>requestRejectedException <span class="token keyword">instanceof</span> <span class="token class-name">RequestRejectedException</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>requestRejectedHandler<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> request<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> response<span class="token punctuation">,</span>
             <span class="token punctuation">(</span><span class="token class-name">RequestRejectedException</span><span class="token punctuation">)</span> requestRejectedException<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>securityContextHolderStrategy<span class="token punctuation">.</span><span class="token function">clearContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       request<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token constant">FILTER_APPLIED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>  <span class="token comment">//FilterChainï¼šæœ€é¡¶å±‚çš„filterï¼Œä¾‹å¦‚tomcatä¸­çš„</span>
    <span class="token class-name">FirewalledRequest</span> firewallRequest <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firewall<span class="token punctuation">.</span><span class="token function">getFirewalledRequest</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HttpServletResponse</span> firewallResponse <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firewall<span class="token punctuation">.</span><span class="token function">getFirewalledResponse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¾—åˆ°filters</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Filter</span><span class="token punctuation">&gt;</span></span> filters <span class="token operator">=</span> <span class="token number">1</span>ï¸âƒ£<span class="token function">getFilters</span><span class="token punctuation">(</span>firewallRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>filters <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> filters<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;No security for &quot;</span> <span class="token operator">+</span> <span class="token function">requestLine</span><span class="token punctuation">(</span>firewallRequest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       firewallRequest<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">this</span><span class="token number">.2</span>ï¸âƒ£filterChainDecorator<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span>chain<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>firewallRequest<span class="token punctuation">,</span> firewallResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Securing &quot;</span> <span class="token operator">+</span> <span class="token function">requestLine</span><span class="token punctuation">(</span>firewallRequest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">FilterChain</span> reset <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Secured &quot;</span> <span class="token operator">+</span> <span class="token function">requestLine</span><span class="token punctuation">(</span>firewallRequest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token comment">// Deactivate path stripping as we exit the security filter chain</span>
       firewallRequest<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>filterChainDecorator<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span>reset<span class="token punctuation">,</span> filters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>firewallRequest<span class="token punctuation">,</span> firewallResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//è°ƒç”¨doFilter</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>è¯¥æ–¹æ³•ä½¿<code>filters(List&lt;Filter&gt; filters = getFilters(firewallRequest); )</code>ä¸­çš„è¿‡æ»¤å™¨å¾—åˆ°åº”ç”¨</p> <p>filtersé€šè¿‡filterChainProxyæ„é€ æ–¹æ³•ä¼ å…¥</p></blockquote> <p>1ï¸âƒ£getFilters(HttpServletRequest request)</p> <div class="language- extra-class"><pre class="language-text"><code>private List&lt;Filter&gt; getFilters(HttpServletRequest request) {
    int count = 0;
    for (SecurityFilterChain chain : this.filterChains) {
       if (logger.isTraceEnabled()) {
          logger.trace(LogMessage.format(&quot;Trying to match request against %s (%d/%d)&quot;, chain, ++count,
                this.filterChains.size()));
       }

		//ğŸŒŸåªä¼šæ‰§è¡ŒfilterChainsä¸­ç¬¬ä¸€ä¸ªåŒ¹é…çš„SecurityFilterChain
       if (chain.matches(request)) {
          return chain.getFilters();  //å¾—åˆ°SecurityFilterChainä¸­æ‰€æœ‰çš„è¿‡æ»¤å™¨
       }
    }
    return null;
}

</code></pre></div><p>2ï¸âƒ£å…³äºspring6.1ä¸­çš„VirtualFilterChainï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>private FilterChainProxy.FilterChainDecorator filterChainDecorator
    = new FilterChainProxy.VirtualFilterChainDecorator()

</code></pre></div><h2 id="springsecurityæµç¨‹"><a href="#springsecurityæµç¨‹" class="header-anchor">#</a> SpringSecurityæµç¨‹</h2> <blockquote><p>ä¸€ä¸ªFilterChainProxyï¼Œå…¶ä¸­æœ‰ä¸€å †SecurityFilterChainï¼Œæ¯ä¸ªä¼ è¿‡æ¥çš„è¯·æ±‚éƒ½è¦ç»è¿‡requestMatcheræ¥åŒ¹é…ï¼Œå¦‚æœåŒ¹é…å°±åº”ç”¨SecurityFilterChainå…¶ä¸­çš„ä¸€å †è¿‡æ»¤å™¨ã€‚</p> <p>ç¨‹åºä¸€èˆ¬åªæœ‰ä¸€ä¸ªSecurityFilterChainã€‚</p> <p>FilterChainProxyè°ƒç”¨doFilteræ–¹æ³•ï¼Œå†è°ƒç”¨doFilterInternalæ–¹æ³•ï¼Œé€šè¿‡getFilters(HttpServletRequest request)æ–¹æ³•é€šè¿‡ä¼ å…¥çš„requestå¾—åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„SecurityFilterChainï¼Œé€šè¿‡getFilters()æ–¹æ³•å¾—åˆ°SecurityFilterChainä¸­æ‰€æœ‰çš„è¿‡æ»¤å™¨ï¼Œæ„å»ºä¸ºä¸€ä¸ªVirtualFilterChainï¼Œæœ€åè°ƒç”¨æ¯ä¸ªè¿‡æ»¤å™¨çš„doFilteræ–¹æ³•ã€‚</p></blockquote> <h2 id="httpsecurityå’Œwebsecurityçš„é…ç½®"><a href="#httpsecurityå’Œwebsecurityçš„é…ç½®" class="header-anchor">#</a> HttpSecurityå’ŒWebSecurityçš„é…ç½®</h2> <div class="language- extra-class"><pre class="language-text"><code>public class SecurityConfig {
    @Bean
    public DefaultSecurityFilterChain securityFilterChain(HttpSecurity http) {
	    ......
        return http.build();
    }

    @Bean
    public WebSecurityCustomizer webSecurityCustomizer() {
        return web -&gt; {
            ......
        }
    }
}

</code></pre></div><hr> <h1 id="ä¸‰ä¸ªæ ¸å¿ƒç±»"><a href="#ä¸‰ä¸ªæ ¸å¿ƒç±»" class="header-anchor">#</a> ä¸‰ä¸ªæ ¸å¿ƒç±»</h1> <ul><li>HttpSecurity</li> <li>SecurityConfigurer</li> <li>AbstractConfiguredSecurityBuilder(é—´æ¥å®ç°äº†SecurityBuilder)</li></ul> <blockquote><p>SecurityBuilderç”¨æ¥æ„å»ºå®‰å…¨å¯¹è±¡ï¼Œå®‰å…¨å¯¹è±¡åŒ…æ‹¬ï¼šHttpSecurityã€FilterChainProxyã€AuthenticationManager SecurityConfigurerç”¨æ¥é…ç½®å®‰å…¨å¯¹è±¡æ„å»ºå™¨ï¼ˆSecurityBuilderï¼‰ï¼Œå…¸å‹çš„æœ‰ï¼šFormLoginConfigurerã€CsrfConfigurer</p></blockquote> <h2 id="securityconfigurer"><a href="#securityconfigurer" class="header-anchor">#</a> SecurityConfigurer</h2> <blockquote><p>å®‰å…¨æ„å»ºå™¨SecurityBuilderçš„é…ç½®å™¨</p></blockquote> <blockquote><p>SecurityBuilderç”¨æ¥æ„å»ºä¸€ä¸ªå¯¹è±¡ï¼ŒSecurityConfigurerç”¨æ¥é…ç½®ä¸€ä¸ªSecurityBuilder</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Allows for configuring a {@link SecurityBuilder}. All {@link SecurityConfigurer} first
 * have their {@link #init(SecurityBuilder)} method invoked. After all
 * {@link #init(SecurityBuilder)} methods have been invoked, each
 * {@link #configure(SecurityBuilder)} method is invoked.
 * //å¿…é¡»å…ˆè°ƒç”¨initå†è°ƒç”¨configure
 * * @param &lt;O&gt; The object being built by the {@link SecurityBuilder} B
 * @param &lt;B&gt; The {@link SecurityBuilder} that builds objects of type O. This is also the
 * {@link SecurityBuilder} that is being configured.
 * @author Rob Winch * @see AbstractConfiguredSecurityBuilder
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SecurityConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">SecurityBuilder</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * Initialize the {@link SecurityBuilder}. Here only shared state should be created
     * and modified, but not properties on the {@link SecurityBuilder} used for building
     * the object. This ensures that the {@link #configure(SecurityBuilder)} method uses
     * the correct shared objects when building. Configurers should be applied here.     * @param builder
     * @throws Exception
     */</span>
    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">B</span> builder<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Configure the {@link SecurityBuilder} by setting the necessary properties on the
     * {@link SecurityBuilder}.
     * @param builder
     * @throws Exception
     */</span>
    <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">B</span> builder<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre></div><h2 id="abstractconfiguredsecuritybuilder"><a href="#abstractconfiguredsecuritybuilder" class="header-anchor">#</a> AbstractConfiguredSecurityBuilder</h2> <p><img src="/Sardinary/assets/img/Untitled4.02192c85.png" alt="Untitled"></p> <blockquote><p>ç±»å›¾ä¸­AbstractSecurityBuilderçš„ä½œç”¨ï¼šæ§åˆ¶buildåªèƒ½æ„å»ºä¸€æ¬¡</p></blockquote> <p><strong>AbstractConfiguredSecurityBuilderè¢«SecurityConfigureræ‰€é…ç½®</strong></p> <p>AbstractConfiguredSecurityBuilderç±»ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractConfiguredSecurityBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">SecurityBuilder</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token keyword">extends</span> <span class="token class-name">AbstractSecurityBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Log</span> logger <span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//è¢«ä¸€å †çš„SecurityConfigureræ‰€é…ç½®</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> configurers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> configurersAddedInInitializing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sharedObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> allowConfigurersOfSameType<span class="token punctuation">;</span>
	<span class="token comment">//æ„å»ºçŠ¶æ€</span>
    <span class="token keyword">private</span> <span class="token class-name">BuildState</span> buildState <span class="token operator">=</span> <span class="token class-name">BuildState</span><span class="token punctuation">.</span><span class="token constant">UNBUILT</span><span class="token punctuation">;</span>
	<span class="token comment">//å¯¹è±¡åç½®å¤„ç†</span>
	<span class="token comment">//å¯ä»¥å®ç°é‡Œé¢çš„postProcesseræ–¹æ³•è‡ªå®šä¹‰å¤„ç†</span>
    <span class="token keyword">private</span> <span class="token class-name">ObjectPostProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> objectPostProcessor<span class="token punctuation">;</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">C</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">setSharedObject</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">C</span><span class="token punctuation">&gt;</span></span> sharedType<span class="token punctuation">,</span> <span class="token class-name">C</span> object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">this</span><span class="token punctuation">.</span>sharedObjects<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>sharedType<span class="token punctuation">,</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">C</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">C</span> <span class="token function">getSharedObject</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">C</span><span class="token punctuation">&gt;</span></span> sharedType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">C</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sharedObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>sharedType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token comment">//ğŸŒŸaddæ–¹æ³•</span>
	<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">C</span> <span class="token keyword">extends</span> <span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">C</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>configurer<span class="token punctuation">,</span> <span class="token string">&quot;configurer cannot be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> configurer
	       <span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token number">.1</span>ï¸âƒ£buildState<span class="token punctuation">.</span><span class="token function">isConfigured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//åˆ¤æ–­æ˜¯å¦å·²ç»configuredï¼Œå·²ç»æ„å»ºçš„ä¸èƒ½åº”ç”¨é…ç½®å™¨</span>
	          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot apply &quot;</span> <span class="token operator">+</span> configurer <span class="token operator">+</span> <span class="token string">&quot; to already built object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> configs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>allowConfigurersOfSameType<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//æ˜¯å¦å…è®¸åŒä¸€ä¸ªç±»å‹çš„configurer</span>
	          configs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	       <span class="token comment">//å¦‚æœä¸å…è®¸ï¼Œåˆ™configsä¸€å®šä¸ºnull</span>
	       configs <span class="token operator">=</span> <span class="token punctuation">(</span>configs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> configs <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//å¦‚æœ==nullï¼Œå…ˆåˆå§‹åŒ–</span>
	       configs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>configurer<span class="token punctuation">)</span><span class="token punctuation">;</span>
	       <span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	       <span class="token number">3</span>ï¸âƒ£ğŸŒŸ<span class="token comment">//åˆå§‹åŒ–è¿‡ç¨‹ä¸­åŠ å…¥çš„configureåŠ å…¥configurersAddedInInitializing</span>
	       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>buildState<span class="token punctuation">.</span><span class="token function">isInitializing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	          <span class="token keyword">this</span><span class="token punctuation">.</span>configurersAddedInInitializing<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>configurer<span class="token punctuation">)</span><span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">O</span> <span class="token function">doBuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       <span class="token keyword">this</span><span class="token punctuation">.</span>buildState <span class="token operator">=</span> <span class="token class-name">BuildState</span><span class="token punctuation">.</span><span class="token constant">INITIALIZING</span><span class="token punctuation">;</span>  <span class="token comment">//çŠ¶æ€å˜ä¸ºæ­£åœ¨åˆå§‹åŒ–</span>
	       <span class="token function">beforeInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	       <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token number">4</span>ï¸âƒ£<span class="token comment">//åˆå§‹åŒ–</span>
	       <span class="token keyword">this</span><span class="token punctuation">.</span>buildState <span class="token operator">=</span> <span class="token class-name">BuildState</span><span class="token punctuation">.</span><span class="token constant">CONFIGURING</span><span class="token punctuation">;</span> <span class="token comment">//çŠ¶æ€æ”¹ä¸ºæ­£åœ¨é…ç½®</span>
	       <span class="token function">beforeConfigure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">5</span>ï¸âƒ£
	       <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">6</span>ï¸âƒ£
	       <span class="token keyword">this</span><span class="token punctuation">.</span>buildState <span class="token operator">=</span> <span class="token class-name">BuildState</span><span class="token punctuation">.</span><span class="token constant">BUILDING</span><span class="token punctuation">;</span>  <span class="token comment">//çŠ¶æ€æ”¹ä¸ºæ­£åœ¨æ„å»º</span>
	       <span class="token comment">//ğŸŒŸ7ï¸âƒ£performBuild()æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¿…é¡»å­ç±»å®ç°ï¼ŒçœŸæ­£å®ç°æ„å»ºçš„æ–¹æ³•</span>
	       <span class="token class-name">O</span> result <span class="token operator">=</span> <span class="token function">performBuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	       <span class="token keyword">this</span><span class="token punctuation">.</span>buildState <span class="token operator">=</span> <span class="token class-name">BuildState</span><span class="token punctuation">.</span><span class="token constant">BUILT</span><span class="token punctuation">;</span>
	       <span class="token keyword">return</span> result<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token number">4</span>ï¸âƒ£
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> configurers <span class="token operator">=</span> <span class="token number">2</span>ï¸âƒ£<span class="token function">getConfigurers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token comment">//æ‰€æœ‰çš„é…ç½®å™¨æ¯ä¸ªåˆå§‹åŒ–</span>
	    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SecurityConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span></span> configurer <span class="token operator">:</span> configurers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       configurer<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SecurityConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span></span> configurer <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configurersAddedInInitializing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       configurer<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token number">2</span>ï¸âƒ£
	<span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getConfigurers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> configs <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       result<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token number">6</span>ï¸âƒ£<span class="token comment">//congigureæ–¹æ³•</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> configurers <span class="token operator">=</span> <span class="token function">getConfigurers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SecurityConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span></span> configurer <span class="token operator">:</span> configurers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       configurer<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getConfigurers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> configs <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       result<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_4ï¸âƒ£init"><a href="#_4ï¸âƒ£init" class="header-anchor">#</a> 4ï¸âƒ£init()</h3> <h3 id="collection-securityconfigurer-o-b-configurers-2ï¸âƒ£getconfigurers-ä½œç”¨"><a href="#collection-securityconfigurer-o-b-configurers-2ï¸âƒ£getconfigurers-ä½œç”¨" class="header-anchor">#</a> Collection&lt;SecurityConfigurer&lt;O, B&gt;&gt; configurers = 2ï¸âƒ£getConfigurers()ä½œç”¨ï¼š</h3> <blockquote><p>æ­¤æ—¶å†å¯¹configurersæ‰§è¡Œputï¼Œé›†åˆä¸­ä¸ä¼šå†æ·»åŠ æ–°çš„å…ƒç´ äº†ï¼Œå› ä¸ºgetConfigurersæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„é›†åˆå¹¶è¿”å›ã€‚</p></blockquote> <h3 id="for-securityconfigurer-o-b-configurer-this-configurersaddedininitializing-ä½œç”¨"><a href="#for-securityconfigurer-o-b-configurer-this-configurersaddedininitializing-ä½œç”¨" class="header-anchor">#</a> for (SecurityConfigurer&lt;O, B&gt; configurer : this.configurersAddedInInitializing)ä½œç”¨ï¼š</h3> <blockquote><p>æ‰§è¡Œç¬¬ä¸€ä¸ªforçš„æ—¶å€™ï¼Œconfigurersä¸­çš„å…ƒç´ æ‰§è¡Œinitæ–¹æ³•æ—¶å€™å¯èƒ½ä¼šæ‰§è¡Œaddä¸€ä¸ªconfigureï¼Œè€Œè¿™ä¸ªæ—¶å€™addçš„configureä¸èƒ½åŠ å…¥configuresé›†åˆäº†ï¼Œåªèƒ½åŠ å…¥æœ€åˆçš„configures mapã€‚</p> <p>ä½†æ˜¯è¿™äº›configureä¹Ÿè¦æ‰§è¡Œinitæ–¹æ³•ï¼Œå› æ­¤å»ºç«‹å±æ€§private final List&lt;SecurityConfigurer&lt;O, B&gt;&gt; configurersAddedInInitializing = new ArrayList&lt;&gt;();ï¼Œå°†è¿™äº›configureåŠ å…¥configurersAddedInInitializingï¼ˆ3ï¸âƒ£ï¼‰ï¼Œéå†æ‰§è¡Œinitæ–¹æ³•ã€‚</p> <p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦å»ºç«‹configurersAddedInInitializingå±æ€§ï¼Œä»¥åŠaddæ–¹æ³•ä¸­3ï¸âƒ£å¤„çš„ä½œç”¨ã€‚</strong></p></blockquote> <blockquote><p>é—®é¢˜ï¼šconfigurersAddedInInitializingä¸­çš„configureæ‰§è¡Œinitæ–¹æ³•çš„æ—¶å€™å†æ‰§è¡Œaddä¸€ä¸ªconfigureä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p></blockquote> <blockquote><p>éªŒè¯ï¼šåœ¨groovy consoleä¸­å†™å…¥</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>List&lt;String&gt; list = new ArrayList&lt;&gt;()
list.add (&quot;1&quot;)
list.add (&quot;2&quot;)
for(String item in list) {
	if (item.equals (&quot;1&quot;)) {
	list. add (&quot;3&quot;)
	}
	System.out.println(item)
ï½

</code></pre></div><blockquote><p>æ‰§è¡ŒæŠ›å‡ºå¼‚å¸¸java.util.ConcurrentModificationException</p> <p>å› ä¸ºæ‰§è¡Œaddçš„æ—¶å€™ArrayListçš„modcount++ï¼Œä¸ç­‰äºexpectedModCountï¼Œä¼šæŠ¥é”™</p></blockquote> <h3 id="_5ï¸âƒ£beforeconfigure"><a href="#_5ï¸âƒ£beforeconfigure" class="header-anchor">#</a> 5ï¸âƒ£beforeConfigure()</h3> <p>åœ¨æœ¬ç±»ä¸­ä¸ºç©ºæ–¹æ³•ï¼Œåœ¨HttpSecurityä¸­æœ‰ä¸€ä¸ªå®ç°</p> <div class="language- extra-class"><pre class="language-text"><code>@Override
protected void beforeConfigure() throws Exception {
    if (this.authenticationManager != null) {
       setSharedObject(AuthenticationManager.class, this.authenticationManager);
    }
    else {
       ObservationRegistry registry = getObservationRegistry();
       AuthenticationManager manager = getAuthenticationRegistry().build();
       if (!registry.isNoop() &amp;&amp; manager != null) {
          setSharedObject(AuthenticationManager.class, new ObservationAuthenticationManager(registry, manager));
       }
       else {
          setSharedObject(AuthenticationManager.class, manager);
       }
    }
}

</code></pre></div><h3 id="_1ï¸âƒ£buildstate"><a href="#_1ï¸âƒ£buildstate" class="header-anchor">#</a> 1ï¸âƒ£BuildState</h3> <div class="language- extra-class"><pre class="language-text"><code>private enum BuildState {

    /**
     * This is the state before the {@link Builder#build()} is invoked     */    UNBUILT(0),

    /**
     * The state from when {@link Builder#build()} is first invoked until all the     * {@link SecurityConfigurer#init(SecurityBuilder)} methods have been invoked.
     */    INITIALIZING(1),

    /**
     * The state from after all {@link SecurityConfigurer#init(SecurityBuilder)} have
     * been invoked until after all the     * {@link SecurityConfigurer#configure(SecurityBuilder)} methods have been
     * invoked.     */    CONFIGURING(2),

    /**
     * From the point after all the     * {@link SecurityConfigurer#configure(SecurityBuilder)} have completed to just
     * after {@link AbstractConfiguredSecurityBuilder#performBuild()}.
     */    BUILDING(3),

    /**
     * After the object has been completely built.     */    BUILT(4);

    private final int order;

    BuildState(int order) {
       this.order = order;
    }

    public boolean isInitializing() {
       return INITIALIZING.order == this.order;
    }

    /**
     * Determines if the state is CONFIGURING or later     * @return     */    public boolean isConfigured() {
       return this.order &gt;= CONFIGURING.order;
    }

}

</code></pre></div><h2 id="httpsecurity-2"><a href="#httpsecurity-2" class="header-anchor">#</a> HttpSecurity</h2> <h3 id="_7ï¸âƒ£httpsecurityå¯¹performbuild-æ–¹æ³•çš„å®ç°"><a href="#_7ï¸âƒ£httpsecurityå¯¹performbuild-æ–¹æ³•çš„å®ç°" class="header-anchor">#</a> 7ï¸âƒ£HttpSecurityå¯¹performBuild()æ–¹æ³•çš„å®ç°</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">DefaultSecurityFilterChain</span> <span class="token function">performBuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ExpressionUrlAuthorizationConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> expressionConfigurer <span class="token operator">=</span> <span class="token function">getConfigurer</span><span class="token punctuation">(</span>
          <span class="token class-name">ExpressionUrlAuthorizationConfigurer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AuthorizeHttpRequestsConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> httpConfigurer <span class="token operator">=</span> <span class="token function">getConfigurer</span><span class="token punctuation">(</span><span class="token class-name">AuthorizeHttpRequestsConfigurer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> oneConfigurerPresent <span class="token operator">=</span> expressionConfigurer <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">^</span> httpConfigurer <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

	 <span class="token comment">//è¯¥åˆ¤æ–­çš„å«ä¹‰ï¼šexpressionConfigurerå’ŒhttpConfigureråªèƒ½é…ç½®ä¸€ä¸ª</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">(</span>expressionConfigurer <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> httpConfigurer <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span> oneConfigurerPresent<span class="token punctuation">,</span>
          <span class="token string">&quot;authorizeHttpRequests cannot be used in conjunction with authorizeRequests. Please select just one.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">OrderComparator</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Filter</span><span class="token punctuation">&gt;</span></span> sortedFilters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Filter</span> filter <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       sortedFilters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">OrderedFilter</span><span class="token punctuation">)</span> filter<span class="token punctuation">)</span><span class="token punctuation">.</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSecurityFilterChain</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>requestMatcher<span class="token punctuation">,</span> sortedFilters<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>è¯¥æ–¹æ³•æœ€ç»ˆæ„å»ºå‡ºDefaultSecurityFilterChainï¼ˆå±æ€§ä¸ºä¸€å †filterså’Œä¸€ä¸ªrequestMatcherï¼‰</p></blockquote> <blockquote><p>åœ¨HttpSecurityä¸­ï¼Œé»˜è®¤çš„requestMatcherä¸ºï¼š</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>private RequestMatcher requestMatcher = AnyRequestMatcher.INSTANCE;

</code></pre></div><blockquote><p>å…¶matchesæ–¹æ³•è¿”å›trueï¼ŒåŒ¹é…æ‰€æœ‰request</p> <p>åœ¨HttpSecurityçš„requestMatcheræ–¹æ³•ä¸­ï¼Œå¯ä»¥è‡ªå®šä¹‰requestMatcher</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>public HttpSecurity requestMatcher (RequestMatcher requestMatcher) {
	this.requestMatcher = requestMatcher;
	return this;
ï½

</code></pre></div><hr> <h1 id="å››ä¸ªæ ¸å¿ƒç±»"><a href="#å››ä¸ªæ ¸å¿ƒç±»" class="header-anchor">#</a> å››ä¸ªæ ¸å¿ƒç±»</h1> <ul><li><p>AuthenticationManager</p> <p>ä¸€ä¸ªå®‰å…¨å¯¹è±¡</p> <p>ç”¨æ¥è®¤è¯ï¼Œè®¤è¯çš„æ—¶å€™éœ€è¦ä¸€ä¸ªAuthentication</p> <p>è®¤è¯åè¿”å›ä¸€ä¸ªæ ‡è®°ä¸ºå·²è®¤è¯çš„Authenticationå¯¹è±¡</p></li> <li><p>AuthenticationManagerBuilder</p> <p>ç”¨æ¥æ„å»ºAuthenticationManagerçš„SecurityBuilder</p> <p>ç»§æ‰¿è‡ªAbstractConfiguredSecurityBuilder</p></li> <li><p>ProviderManager</p> <p>AuthenticationManagerçš„å…·ä½“å®ç°</p> <p>ä¸€ä¸ªProviderManagerä¸­æœ‰å¾ˆå¤šAuthenticationProvider</p></li> <li><p>AuthenticationProvider</p> <p>è®¤è¯ç­–ç•¥æ¨¡å¼çš„å®ç°ç±»</p></li></ul> <h2 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h2> <p>åªæ˜¯å°è£…è®¤è¯ä¿¡æ¯ã€‚æ²¡æœ‰ä»»ä½•é€»è¾‘ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>public interface Authentication extends Principal, Serializable {
	//è·å–æƒé™/è§’è‰²
	Collection&lt;? extends GrantedAuthority&gt; getAuthorities();
	//è·å–å‡­è¯ï¼ˆå¦‚å¯†ç ï¼‰
	Object getCredentials();
	//è·å–è¯¦ç»†ä¿¡æ¯
	Object getDetails();
	//è·å–ä¸»ä½“ï¼ˆå¦‚ç”¨æˆ·åï¼‰
	Object getPrincipal();
	boolean isAuthenticated();
	void setAuthenticated(boolean isAuthenticated) throws IllegalArgumentException;
}

</code></pre></div><p>æœ‰ä¸€ä¸ªé‡è¦çš„å®ç°ç±»UsernamePasswordAuthenticationToken</p> <h2 id="authenticationmanager"><a href="#authenticationmanager" class="header-anchor">#</a> AuthenticationManager</h2> <div class="language- extra-class"><pre class="language-text"><code>public interface AuthenticationManager {
	Authentication authenticate(Authentication authentication) throws AuthenticationException;
}

</code></pre></div><p>authenticateæ–¹æ³•è¿”å›ä¸€ä¸ªå¡«å……å¥½æ‰€æœ‰å±æ€§çš„Authenticationå¯¹è±¡</p> <h2 id="authenticationmanagerbuilder"><a href="#authenticationmanagerbuilder" class="header-anchor">#</a> AuthenticationManagerBuilder</h2> <p>æè¿°ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>SecurityBuilder used to create an AuthenticationManager. Allows for easily building in memory authentication, LDAP authentication, JDBC based authentication, adding UserDetailsService, and adding AuthenticationProvider's.

</code></pre></div><p><img src="/Sardinary/assets/img/Untitled5.a368cc08.png" alt="Untitled"></p> <h3 id="å±æ€§"><a href="#å±æ€§" class="header-anchor">#</a> å±æ€§</h3> <div class="language- extra-class"><pre class="language-text"><code>public class AuthenticationManagerBuilder
       extends AbstractConfiguredSecurityBuilder&lt;AuthenticationManager, AuthenticationManagerBuilder&gt;
       implements ProviderManagerBuilder&lt;AuthenticationManagerBuilder&gt; {

    private final Log logger = LogFactory.getLog(getClass());

    private AuthenticationManager parentAuthenticationManager;

    private List&lt;AuthenticationProvider&gt; authenticationProviders = new ArrayList&lt;&gt;();

    private UserDetailsService defaultUserDetailsService;

    private Boolean eraseCredentials;

    private AuthenticationEventPublisher eventPublisher;

	......

</code></pre></div><p>ç»§æ‰¿è‡ªAbstractConfiguredSecurityBuilderï¼Œè€Œè¿™ä¸ªæŠ½è±¡ç±»æœ€é‡è¦çš„æ–¹æ³•æ˜¯<strong>performBuildæ–¹æ³•</strong></p> <h3 id="performbuild"><a href="#performbuild" class="header-anchor">#</a> performBuild()</h3> <div class="language- extra-class"><pre class="language-text"><code>@Override
protected ProviderManager performBuild() throws Exception {
    if (!isConfigured()) {  //å¦‚æœæ²¡æœ‰é…ç½®å°±æƒ³æ„å»ºï¼Œè¿”å›null
       this.logger.debug(&quot;No authenticationProviders and no parentAuthenticationManager defined. Returning null.&quot;);
       return null;
    }
    ProviderManager providerManager = new ProviderManager(this.authenticationProviders, this.parentAuthenticationManager);
    if (this.eraseCredentials != null) { //æ¸…é™¤å‡­è¯
       providerManager.setEraseCredentialsAfterAuthentication(this.eraseCredentials);
    }
    if (this.eventPublisher != null) {  //è®¾ç½®æ—¶é—´å‘å¸ƒå™¨
       providerManager.setAuthenticationEventPublisher(this.eventPublisher);
    }
    providerManager = postProcess(providerManager);  //åå¤„ç†
    return providerManager;
}

</code></pre></div><blockquote><p>ProviderManager providerManager = new ProviderManager(this.authenticationProviders, this.parentAuthenticationManager)ï¼š</p> <p>è®¾ç½®authenticationProvidersï¼Œå³ä¸€å †çš„<a href="https://sardinary.vercel.app/spring/spring-security-01/#authentication-provider" target="_blank" rel="noopener noreferrer">AuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼›å’ŒparentAuthenticationManagerï¼Œå³çˆ¶ç±»çš„<a href="https://sardinary.vercel.app/spring/spring-security-01/#authentication-manager" target="_blank" rel="noopener noreferrer">AuthenticationManager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>è¿”å›å€¼ä¸ºProviderManager</p></blockquote> <h3 id="postprocess-providermanager"><a href="#postprocess-providermanager" class="header-anchor">#</a> postProcess(providerManager)</h3> <p>åå¤„ç†ã€‚å¯ä»¥å®ç°ObjectPostProcesseræ¥å£ï¼Œå®ç°postProcesseræ–¹æ³•å®ç°è‡ªå®šä¹‰é…ç½®</p> <div class="language- extra-class"><pre class="language-text"><code>public interface ObjectPostProcessor&lt;T&gt; {
	&lt;O extends T&gt; O postProcess (O object);
ï½

</code></pre></div><h3 id="å±æ€§è®¾ç½®"><a href="#å±æ€§è®¾ç½®" class="header-anchor">#</a> å±æ€§è®¾ç½®</h3> <h3 id="authenticationprovideråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®"><a href="#authenticationprovideråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®" class="header-anchor">#</a> AuthenticationProvideråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®</h3> <div class="language- extra-class"><pre class="language-text"><code>@Override
public AuthenticationManagerBuilder authenticationProvider(AuthenticationProvider authenticationProvider) {
    this.authenticationProviders.add(authenticationProvider);
    return this;
}

</code></pre></div><h3 id="parentauthenticationmanageråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®"><a href="#parentauthenticationmanageråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®" class="header-anchor">#</a> parentAuthenticationManageråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®</h3> <div class="language- extra-class"><pre class="language-text"><code>public AuthenticationManagerBuilder parentAuthenticationManager(AuthenticationManager authenticationManager) {
    if (authenticationManager instanceof ProviderManager) {
       eraseCredentials(((ProviderManager) authenticationManager).isEraseCredentialsAfterAuthentication());
    }
    this.parentAuthenticationManager = authenticationManager;
    return this;
}

</code></pre></div><h2 id="authenticationprovider"><a href="#authenticationprovider" class="header-anchor">#</a> AuthenticationProvider</h2> <div class="language- extra-class"><pre class="language-text"><code>public interface AuthenticationProvider {
	Authentication authenticate(Authentication authentication) throws AuthenticationException;
	//æ˜¯å¦æ”¯æŒè®¤è¯ï¼Œè¿”å›trueå°±è°ƒç”¨authenticateæ–¹æ³•

    boolean supports(Class&lt;?&gt; authentication);
}

</code></pre></div><h3 id="authenticate-authentication-authentication"><a href="#authenticate-authentication-authentication" class="header-anchor">#</a> authenticate(Authentication authentication)</h3> <p>å’Œ<a href="https://sardinary.vercel.app/spring/spring-security-01/#authentication-manager" target="_blank" rel="noopener noreferrer">AuthenticationManager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„authenticateæ–¹æ³•ç›¸åŒ</p> <h3 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="header-anchor">#</a> ç­–ç•¥æ¨¡å¼</h3> <p>ä¸€ä¸ªé—®é¢˜å¤šç§è§£æ³•ã€‚ç‰¹ç‚¹æœ‰è§£è€¦ï¼ŒèŒè´£å•ä¸€ï¼Œå¼€é—­åŸåˆ™</p> <h2 id="providermanager"><a href="#providermanager" class="header-anchor">#</a> ProviderManager</h2> <p><img src="/Sardinary/assets/img/Untitled6.0a6834f4.png" alt="Untitled"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProviderManager</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationManager</span><span class="token punctuation">,</span> <span class="token class-name">MessageSourceAware</span><span class="token punctuation">,</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Log</span> logger <span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token class-name">ProviderManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">AuthenticationEventPublisher</span> eventPublisher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NullEventPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AuthenticationProvider</span><span class="token punctuation">&gt;</span></span> providers <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token number">1</span>ï¸âƒ£

    <span class="token keyword">protected</span> <span class="token class-name">MessageSourceAccessor</span> messages <span class="token operator">=</span> <span class="token class-name">SpringSecurityMessageSource</span><span class="token punctuation">.</span><span class="token function">getAccessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">AuthenticationManager</span> parent<span class="token punctuation">;</span>  <span class="token number">1</span>ï¸âƒ£

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> eraseCredentialsAfterAuthentication <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Authentication</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
	    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Authentication</span><span class="token punctuation">&gt;</span></span> toTest <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æµ‹è¯•authenticationæ˜¯å¦æ”¯æŒ</span>
	    <span class="token class-name">AuthenticationException</span> lastException <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	    <span class="token class-name">AuthenticationException</span> parentException <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	    <span class="token class-name">Authentication</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	    <span class="token class-name">Authentication</span> parentResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	    <span class="token keyword">int</span> currentPosition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	    <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>providers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token comment">//é€ä¸ªproviderå»è°ƒç”¨toTestæ–¹æ³•</span>
	    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationProvider</span> provider <span class="token operator">:</span> <span class="token function">getProviders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>provider<span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>toTest<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	          <span class="token keyword">continue</span><span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	       <span class="token comment">//å¦‚æœæ”¯æŒï¼Œç»§ç»­è®¤è¯</span>
	       <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	          logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Authenticating request with %s (%d/%d)&quot;</span><span class="token punctuation">,</span>
	                provider<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">++</span>currentPosition<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	       <span class="token keyword">try</span> <span class="token punctuation">{</span>
	          result <span class="token operator">=</span> provider<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
	          <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	             <span class="token function">copyDetails</span><span class="token punctuation">(</span>authentication<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//å°†authenticationé€šè¿‡copyDetailsèµ‹å€¼ç»™result</span>
	             <span class="token keyword">break</span><span class="token punctuation">;</span>
	          <span class="token punctuation">}</span>
	       <span class="token punctuation">}</span>
	       <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AccountStatusException</span> <span class="token operator">|</span> <span class="token class-name">InternalAuthenticationServiceException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	          <span class="token function">prepareException</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
	          <span class="token comment">// SEC-546: Avoid polling additional providers if auth failure is due to</span>
	          <span class="token comment">// invalid account status          throw ex;</span>
	       <span class="token punctuation">}</span>
	       <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	          lastException <span class="token operator">=</span> ex<span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	    <span class="token punctuation">}</span>
	    <span class="token comment">//forå¾ªç¯ä¸­çš„provideréƒ½ä¸æ”¯æŒï¼Œresult == null</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       <span class="token comment">// Allow the parent to try.</span>
	       <span class="token keyword">try</span> <span class="token punctuation">{</span>
	          parentResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//2ï¸âƒ£è°ƒç”¨parentçš„authenticateï¼Œæµ‹è¯•parentçš„provideræ˜¯å¦æ”¯æŒ</span>
	          result <span class="token operator">=</span> parentResult<span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	       <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ProviderNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	          <span class="token comment">// ignore as we will throw below if no other exception occurred prior to</span>
	          <span class="token comment">// calling parent and the parent          // may throw ProviderNotFound even though a provider in the child already          // handled the request       }</span>
	       <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	          parentException <span class="token operator">=</span> ex<span class="token punctuation">;</span>
	          lastException <span class="token operator">=</span> ex<span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	    <span class="token punctuation">}</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>eraseCredentialsAfterAuthentication <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">CredentialsContainer</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//æ˜¯å¦æ“¦é™¤å‡­è¯ä¿¡æ¯ã€‚ç™»å½•æˆåŠŸåœ¨å†…å­˜æ“¦å‡ºå‡­è¯ä¿¡æ¯ï¼Œä¿æŠ¤éšç§</span>
	          <span class="token comment">// Authentication is complete. Remove credentials and other secret data</span>
	          <span class="token comment">// from authentication          ((CredentialsContainer) result).eraseCredentials();</span>
	       <span class="token punctuation">}</span>
	       <span class="token comment">// If the parent AuthenticationManager was attempted and successful then it</span>
	       <span class="token comment">// will publish an AuthenticationSuccessEvent</span>
	       <span class="token comment">// This check prevents a duplicate AuthenticationSuccessEvent if the parent</span>
	       <span class="token comment">// AuthenticationManager already published it</span>
	       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">3</span>ï¸âƒ£parentResult <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	          <span class="token keyword">this</span><span class="token punctuation">.</span>eventPublisher<span class="token punctuation">.</span><span class="token function">publishAuthenticationSuccess</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>

	       <span class="token keyword">return</span> result<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>

	    <span class="token comment">// Parent was null, or didn't authenticate (or throw an exception).</span>
	    <span class="token comment">//æ²¡æœ‰ä¸€ä¸ªprovicerå¯ä»¥æ”¯æŒè®¤è¯</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span>lastException <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	       lastException <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProviderNotFoundException</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;ProviderManager.providerNotFound&quot;</span><span class="token punctuation">,</span>
	             <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> toTest<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;No AuthenticationProvider found for {0}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token comment">// If the parent AuthenticationManager was attempted and failed then it will</span>
	    <span class="token comment">// publish an AbstractAuthenticationFailureEvent    // This check prevents a duplicate AbstractAuthenticationFailureEvent if the    // parent AuthenticationManager already published it    if (parentException == null) {</span>
	       <span class="token function">prepareException</span><span class="token punctuation">(</span>lastException<span class="token punctuation">,</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token keyword">throw</span> lastException<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

</code></pre></div><h3 id="authenticateæ–¹æ³•"><a href="#authenticateæ–¹æ³•" class="header-anchor">#</a> authenticateæ–¹æ³•</h3> <blockquote><p>1ï¸âƒ£å…ˆä½¿ç”¨providersä¸­çš„AuthenticationProviderï¼Œå¦‚æœéƒ½ä¸æ”¯æŒï¼Œå°±è°ƒç”¨çˆ¶ç±»çš„AuthenticationProviderã€‚</p> <p>å¦‚æœå†è®¤è¯ä¸è¿‡ï¼Œå°±æŠ¥é”™</p></blockquote> <blockquote><p>2ï¸âƒ£parentçš„providerä¸­ï¼Œæœ€ä¸»è¦çš„è¿˜æ˜¯ProviderManager</p> <p><img src="/Sardinary/assets/img/Untitled7.5feb62db.png" alt="Untitled"></p></blockquote> <blockquote><p>3ï¸âƒ£åˆ¤æ–­äº‹ä»¶æ˜¯ç”±è°å‘ç”Ÿçš„ã€‚è¿”å›falseè¯´æ˜äº‹ä»¶ç”±çˆ¶ç±»å®Œæˆè®¤è¯ï¼Œçˆ¶ç±»å®Œæˆçš„è®¤è¯çˆ¶ç±»æ¥å‘å¸ƒã€‚åŒæ—¶é¿å…é‡å¤å‘å¸ƒã€‚</p></blockquote> <h3 id="æµç¨‹"><a href="#æµç¨‹" class="header-anchor">#</a> æµç¨‹</h3> <p>å­ç±»çš„provideré€ä¸ªè®¤è¯ï¼Œå¦‚æœè®¤è¯éƒ½ä¸æˆåŠŸï¼Œå°±ç”¨çˆ¶ç±»çš„provideré€ä¸ªè®¤è¯ã€‚å¦‚æœå­ç±»å’Œçˆ¶ç±»ä¸­æ²¡æœ‰ä¸€ä¸ªprovideræ”¯æŒè®¤è¯ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚</p> <p>å¦‚æœè®¤è¯æˆåŠŸï¼Œå°†authenticationé€šè¿‡copyDetailsèµ‹å€¼ç»™result</p> <h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p><strong>AuthenticationManagerBuilderæ„å»ºAuthenticationManagerï¼Œå®é™…ä¸Šå°±æ˜¯æ„å»ºProviderManagerï¼ˆæ˜¯AuthenticationManagerçš„ä¸€ä¸ªå…·ä½“å®ç°ï¼‰AuthenticationProvideræ˜¯çœŸæ­£è®¤è¯è¯·æ±‚çš„ProviderManagerç»´æŠ¤äº†ä¸€å †çš„AuthenticationProviderï¼Œè®¤è¯çš„æ—¶å€™è°ƒç”¨AuthenticationProviderçš„authenticateæ–¹æ³•</strong></p> <hr> <h1 id="äº”ä¸ªæ ¸å¿ƒç±»"><a href="#äº”ä¸ªæ ¸å¿ƒç±»" class="header-anchor">#</a> äº”ä¸ªæ ¸å¿ƒç±»</h1> <ul><li><p>UserDetailsService</p></li> <li><p>DaoAuthenticationProvider</p> <p>æ•°æ®åº“ç›¸å…³è®¤è¯</p></li> <li><p>AbstractUserDetailsAuthenticationProvider</p> <p>DaoAuthenticationProviderçš„ä¸€ä¸ªçˆ¶ç±»</p></li> <li><p>UsernamePasswordAuthenticationFilter</p></li> <li><p>FormLoginConfigurer</p> <p>æ˜¯ä¸€ä¸ª<a href="https://sardinary.vercel.app/spring/spring-security-01/#security-configurer" target="_blank" rel="noopener noreferrer">SecurityConfigurer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ç”¨æ¥é…ç½®UsernamePasswordAuthenticationFilter</p> <p>é…ç½®çš„æ˜¯HttpSecurityBuilderï¼ˆ<a href="https://sardinary.vercel.app/spring/spring-security-01/#http-security" target="_blank" rel="noopener noreferrer">HttpSecurity<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„æ„å»ºå™¨ï¼‰</p></li></ul> <h2 id="userdetailsservice"><a href="#userdetailsservice" class="header-anchor">#</a> UserDetailsService</h2> <p>é€šè¿‡ç”¨æˆ·ååŠ è½½ç”¨æˆ·ä¿¡æ¯</p> <div class="language- extra-class"><pre class="language-text"><code>public interface UserDetailsService {
	UserDetails loadUserByUsername(String username) throws UsernameNotFoundException;
}

</code></pre></div><p>å®ç°ç±»ï¼š</p> <p><img src="/Sardinary/assets/img/Untitled8.d5d63d17.png" alt="Untitled"></p> <h2 id="daoauthenticationprovider"><a href="#daoauthenticationprovider" class="header-anchor">#</a> DaoAuthenticationProvider</h2> <p><img src="/Sardinary/assets/img/Untitled9.f0c8b167.png" alt="Untitled"></p> <p>AuthenticationProviderçš„å®ç°ç±»ï¼Œé€šè¿‡UserDetailsServiceç”¨æ¥è·å–ç”¨æˆ·è¯¦æƒ…</p> <p>çˆ¶ç±»ä¸º<a href="https://sardinary.vercel.app/spring/spring-security-01/#abstract-user-details-authentication-provider" target="_blank" rel="noopener noreferrer">AbstractUserDetailsAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="abstractuserdetailsauthenticationprovider"><a href="#abstractuserdetailsauthenticationprovider" class="header-anchor">#</a> AbstractUserDetailsAuthenticationProvider</h2> <p><strong>A base AuthenticationProvider that allows subclasses to override and work with UserDetails objects. The class is designed to respond to UsernamePasswordAuthenticationToken authentication requests.</strong></p> <p>æ˜¯<a href="https://sardinary.vercel.app/spring/spring-security-01/#authentication-provider" target="_blank" rel="noopener noreferrer">AuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„å®ç°ç±»</p> <h3 id="ğŸŒŸauthenticateæ–¹æ³•"><a href="#ğŸŒŸauthenticateæ–¹æ³•" class="header-anchor">#</a> ğŸŒŸauthenticateæ–¹æ³•</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Authentication</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isInstanceOf</span><span class="token punctuation">(</span><span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> authentication<span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AbstractUserDetailsAuthenticationProvider.onlySupports&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;Only UsernamePasswordAuthenticationToken is supported&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//æ‹¿åˆ°username</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token number">1</span>ï¸âƒ£<span class="token function">determineUsername</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ˜¯å¦ä½¿ç”¨ç¼“å­˜</span>
    <span class="token keyword">boolean</span> cacheWasUsed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//2ï¸âƒ£è·å–ç¼“å­˜</span>
    <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userCache<span class="token punctuation">.</span><span class="token function">getUserFromCache</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">//ç¼“å­˜é‡Œæ²¡æœ‰user</span>
	    <span class="token comment">//äº‹å®ä¸Šuseræ°¸è¿œç­‰äºnull</span>
       cacheWasUsed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
		    <span class="token comment">//æ‹¿åˆ°ç”¨æˆ·çš„userå¯¹è±¡</span>
		    user <span class="token operator">=</span> <span class="token number">6</span>ï¸âƒ£<span class="token function">retrieveUser</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">)</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UsernameNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to find user '&quot;</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">//3ï¸âƒ£æ˜¯å¦éšè—UserNotFoundExceptions</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>hideUserNotFoundExceptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BadCredentialsException</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages
             <span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bad credentials&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">&quot;retrieveUser returned null - a violation of the interface contract&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
	    <span class="token comment">//æ ¡éªŒ</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>preAuthenticationChecks<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">additionalAuthenticationChecks</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">)</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//4ï¸âƒ£</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cacheWasUsed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token comment">// There was a problem, so try again after checking</span>
       <span class="token comment">// we're using latest data (i.e. not from the cache)       cacheWasUsed = false;</span>
       user <span class="token operator">=</span> <span class="token function">retrieveUser</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">)</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>preAuthenticationChecks<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">additionalAuthenticationChecks</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">)</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ£€éªŒ</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>postAuthenticationChecks<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cacheWasUsed<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//å¦‚æœæ²¡ç”¨ç¼“å­˜ï¼Œå°±åŠ å…¥ç¼“å­˜</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>userCache<span class="token punctuation">.</span><span class="token function">putUserInCache</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Object</span> principalToReturn <span class="token operator">=</span> user<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>forcePrincipalAsString<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//å¦‚æœå¼ºåˆ¶principalä¸ºString</span>
       principalToReturn <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">5</span>ï¸âƒ£<span class="token function">createSuccessAuthentication</span><span class="token punctuation">(</span>principalToReturn<span class="token punctuation">,</span> authentication<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_1ï¸âƒ£determineusername"><a href="#_1ï¸âƒ£determineusername" class="header-anchor">#</a> 1ï¸âƒ£determineUsername</h3> <div class="language- extra-class"><pre class="language-text"><code>private String determineUsername(Authentication authentication) {
    return (authentication.getPrincipal() == null) ? &quot;NONE_PROVIDED&quot; : authentication.getName();
}

</code></pre></div><h3 id="_2ï¸âƒ£useræ°¸è¿œç­‰äºnull"><a href="#_2ï¸âƒ£useræ°¸è¿œç­‰äºnull" class="header-anchor">#</a> 2ï¸âƒ£useræ°¸è¿œç­‰äºnull</h3> <blockquote><p>this.userCacheçš„èµ‹å€¼ä¸ºï¼š</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>private UserCache userCache = new NullUserCache();

</code></pre></div><p>è€ŒNullUserCacheå®ç°äº†UserCacheæ¥å£ã€‚</p> <p>UserCacheæ˜¯ä¸ºäº†åœ¨è¿œç¨‹è¿æ¥çš„æ—¶å€™é¿å…é¢‘ç¹è°ƒç”¨æ•°æ®åº“ï¼Œäºæ˜¯å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨UserCacheä¸­ã€‚</p> <p>ä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬éƒ½ä¿å­˜åœ¨sessionä¸­ï¼Œæ‰€ä»¥SpringSecurityé»˜è®¤ç»™this.userCacheèµ‹å€¼ä¸ºNullUserCacheï¼Œä¸ä½¿ç”¨UserCache</p> <p>æ‰€ä»¥2ï¸âƒ£ä½ç½®useræ°¸è¿œç­‰äºnull</p> <p>ä¹Ÿå¯ä»¥å®ç°è‡ªå·±çš„UserCacheï¼Œè¯¥ç±»ä¸­æä¾›äº†æ–¹æ³•setUserCache</p> <div class="language- extra-class"><pre class="language-text"><code>public void setUserCache(UserCache userCache) {
    this.userCache = userCache;
}

</code></pre></div><h3 id="_3ï¸âƒ£å…³äºéšè—usernotfoundexceptions"><a href="#_3ï¸âƒ£å…³äºéšè—usernotfoundexceptions" class="header-anchor">#</a> 3ï¸âƒ£å…³äºéšè—UserNotFoundExceptions</h3> <p>3ï¸âƒ£å¤„åˆ¤æ–­æ˜¯å¦éšè—UserNotFoundExceptionsã€‚éšè—ç”¨æˆ·åçš„æ­£ç¡®æ€§ï¼Œæ˜¯ä¸€ç§å®‰å…¨ä¿æŠ¤æœºåˆ¶</p> <h3 id="_4ï¸âƒ£å¦‚æœæ•è·åˆ°äº†authenticationexception"><a href="#_4ï¸âƒ£å¦‚æœæ•è·åˆ°äº†authenticationexception" class="header-anchor">#</a> 4ï¸âƒ£å¦‚æœæ•è·åˆ°äº†AuthenticationException</h3> <blockquote><p>å¦‚æœä¸æ˜¯ä»ç¼“å­˜è·å–ï¼Œåˆ™æŠ›å¼‚å¸¸ã€‚</p></blockquote> <blockquote><p>å¦‚æœæ˜¯ä»ç¼“å­˜è·å–ï¼Œæœ‰ä¸€ç§å¯èƒ½æ˜¯ç¼“å­˜ä¸­ç”¨ç™»å½•å‡­è¯ä¿¡æ¯æ›´æ–°ä¸åŠæ—¶ï¼ˆä¸æ•°æ®åº“ä¿¡æ¯ä¸åŒï¼‰å¯¼è‡´å¼‚å¸¸ï¼Œæ‰€ä»¥å†æ­¤è°ƒç”¨retrieveUseræ–¹æ³•è·å–userå¹¶è¿›è¡Œæ ¡éªŒ</p></blockquote> <h3 id="å…³äºæ ¡éªŒ"><a href="#å…³äºæ ¡éªŒ" class="header-anchor">#</a> å…³äºæ ¡éªŒ</h3> <p>è¯¥ç±»çš„å±æ€§ä¸­ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>private UserDetailsChecker preAuthenticationChecks = new DefaultPreAuthenticationChecks();

private UserDetailsChecker postAuthenticationChecks = new DefaultPostAuthenticationChecks();

</code></pre></div><h3 id="userdetailschecker"><a href="#userdetailschecker" class="header-anchor">#</a> UserDetailsChecker</h3> <div class="language- extra-class"><pre class="language-text"><code>public interface UserDetailsChecker {
	void check(UserDetails toCheck);
}

</code></pre></div><h3 id="defaultpreauthenticationchecks"><a href="#defaultpreauthenticationchecks" class="header-anchor">#</a> DefaultPreAuthenticationChecks</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">DefaultPreAuthenticationChecks</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsChecker</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span><span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">AbstractUserDetailsAuthenticationProvider</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger
             <span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to authenticate since user account is locked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockedException</span><span class="token punctuation">(</span><span class="token class-name">AbstractUserDetailsAuthenticationProvider</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages
             <span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AbstractUserDetailsAuthenticationProvider.locked&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;User account is locked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span><span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">AbstractUserDetailsAuthenticationProvider</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger
             <span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to authenticate since user account is disabled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DisabledException</span><span class="token punctuation">(</span><span class="token class-name">AbstractUserDetailsAuthenticationProvider</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages
             <span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AbstractUserDetailsAuthenticationProvider.disabled&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;User is disabled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span><span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">AbstractUserDetailsAuthenticationProvider</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger
             <span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to authenticate since user account has expired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AccountExpiredException</span><span class="token punctuation">(</span><span class="token class-name">AbstractUserDetailsAuthenticationProvider</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages
             <span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AbstractUserDetailsAuthenticationProvider.expired&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;User account has expired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h3 id="defaultpostauthenticationchecks"><a href="#defaultpostauthenticationchecks" class="header-anchor">#</a> DefaultPostAuthenticationChecks</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">DefaultPostAuthenticationChecks</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsChecker</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span><span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//å‡­è¯æ˜¯å¦è¿‡æœŸ</span>
          <span class="token class-name">AbstractUserDetailsAuthenticationProvider</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger
             <span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to authenticate since user account credentials have expired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CredentialsExpiredException</span><span class="token punctuation">(</span><span class="token class-name">AbstractUserDetailsAuthenticationProvider</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages
             <span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AbstractUserDetailsAuthenticationProvider.credentialsExpired&quot;</span><span class="token punctuation">,</span>
                   <span class="token string">&quot;User credentials have expired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h3 id="additionalauthenticationchecks"><a href="#additionalauthenticationchecks" class="header-anchor">#</a> additionalAuthenticationChecks</h3> <div class="language- extra-class"><pre class="language-text"><code>protected abstract void additionalAuthenticationChecks(UserDetails userDetails,
       UsernamePasswordAuthenticationToken authentication) throws AuthenticationException;

</code></pre></div><p>åšä¸€äº›å‡­è¯ç›¸å…³çš„æ ¡éªŒ</p> <p>è¯¥æ–¹æ³•åœ¨<a href="https://sardinary.vercel.app/spring/spring-security-01/#dao-authentication-provider" target="_blank" rel="noopener noreferrer">DaoAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æœ‰è¯¥æ–¹æ³•çš„å”¯ä¸€å®ç°</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;deprecation&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">additionalAuthenticationChecks</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> userDetails<span class="token punctuation">,</span>
       <span class="token class-name">UsernamePasswordAuthenticationToken</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//åˆ¤æ–­æ˜¯å¦å­˜åœ¨å‡­è¯</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to authenticate since no credentials provided&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BadCredentialsException</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages
          <span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bad credentials&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¾—åˆ°ç”¨æˆ·å‰ç«¯è¾“å…¥çš„æœªåŠ å¯†çš„rawå¯†ç </span>
    <span class="token class-name">String</span> presentedPassword <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è¿›è¡Œç”¨æˆ·å¯†ç æ ¡éªŒ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>presentedPassword<span class="token punctuation">,</span> userDetails<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to authenticate since password does not match stored value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BadCredentialsException</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages
          <span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bad credentials&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>å…¶ä¸­çš„PasswordEncoderä¸ºå¯†ç åŠ å¯†ç±»</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PasswordEncoder</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> rawPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> rawPassword<span class="token punctuation">,</span> <span class="token class-name">String</span> encodedPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">upgradeEncoding</span><span class="token punctuation">(</span><span class="token class-name">String</span> encodedPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_5ï¸âƒ£createsuccessauthentication"><a href="#_5ï¸âƒ£createsuccessauthentication" class="header-anchor">#</a> 5ï¸âƒ£createSuccessAuthentication</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Authentication</span> <span class="token function">createSuccessAuthentication</span><span class="token punctuation">(</span><span class="token class-name">Object</span> principal<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">,</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//å¾—åˆ°ä¸€ä¸ªUsernamePasswordAuthenticationToken</span>
	<span class="token class-name">UsernamePasswordAuthenticationToken</span> result <span class="token operator">=</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span>principal<span class="token punctuation">,</span>authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>authoritiesMapper<span class="token punctuation">.</span><span class="token function">mapAuthorities</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	result<span class="token punctuation">.</span><span class="token function">setDetails</span><span class="token punctuation">(</span>authentication<span class="token punctuation">.</span><span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Authenticated user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="authoritiesmapper"><a href="#authoritiesmapper" class="header-anchor">#</a> authoritiesMapper</h3> <p>this.authoritiesMapperé»˜è®¤ä¸ºç©ºå®ç°(authoritiesåŸæ ·è¿”å›)</p> <div class="language- extra-class"><pre class="language-text"><code>private GrantedAuthoritiesMapper authoritiesMapper = new NullAuthentiesMapper()ï¼›

</code></pre></div><p>ä¹Ÿå¯ä»¥è‡ªå·±å®šåˆ¶GrantedAuthoritiesMapper</p> <h3 id="daoauthenticationproviderä¸­çš„createsuccessauthentication"><a href="#daoauthenticationproviderä¸­çš„createsuccessauthentication" class="header-anchor">#</a> <a href="https://sardinary.vercel.app/spring/spring-security-01/#dao-authentication-provider" target="_blank" rel="noopener noreferrer">DaoAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸­çš„createSuccessAuthentication</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Authentication</span> <span class="token function">createSuccessAuthentication</span><span class="token punctuation">(</span><span class="token class-name">Object</span> principal<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">,</span> <span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//æ˜¯å¦å‡çº§åŠ å¯†</span>
    <span class="token keyword">boolean</span> upgradeEncoding <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userDetailsPasswordService <span class="token operator">!=</span> <span class="token keyword">null</span>
          <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">upgradeEncoding</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>upgradeEncoding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">String</span> presentedPassword <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">String</span> newPassword <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>presentedPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
       user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userDetailsPasswordService<span class="token punctuation">.</span><span class="token function">updatePassword</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> newPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">createSuccessAuthentication</span><span class="token punctuation">(</span>principal<span class="token punctuation">,</span> authentication<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="userdetailspasswordservice"><a href="#userdetailspasswordservice" class="header-anchor">#</a> userDetailsPasswordService</h3> <p>å¯ä»¥é€šè¿‡å®ç°è¯¥æ¥å£æä¾›updatePasswordæ–¹æ³•æ¥è‡ªå®šä¹‰æ›´æ–°å¯†ç </p> <h3 id="_6ï¸âƒ£retrieveuserğŸŒŸ"><a href="#_6ï¸âƒ£retrieveuserğŸŒŸ" class="header-anchor">#</a> 6ï¸âƒ£retrieveUserğŸŒŸ</h3> <h3 id="åœ¨daoauthenticationproviderä¸­å”¯ä¸€å®ç°"><a href="#åœ¨daoauthenticationproviderä¸­å”¯ä¸€å®ç°" class="header-anchor">#</a> åœ¨<a href="https://sardinary.vercel.app/spring/spring-security-01/#dao-authentication-provider" target="_blank" rel="noopener noreferrer">DaoAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸­å”¯ä¸€å®ç°</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">UserDetails</span> <span class="token function">retrieveUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token function">prepareTimingAttackProtection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
	    <span class="token comment">//é€šè¿‡loadUserByUsernameæ‹¿åˆ°UserDetails</span>
       <span class="token class-name">UserDetails</span> loadedUser <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>loadedUser <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalAuthenticationServiceException</span><span class="token punctuation">(</span>
                <span class="token string">&quot;UserDetailsService returned null, which is an interface contract violation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">return</span> loadedUser<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¯ä»¥è‡ªå®šä¹‰getUserDetailsService()ï¼Œåœ¨loadedUser == nullçš„æ—¶å€™æŠ›å‡ºUsernameNotFoundException</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UsernameNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">mitigateAgainstTimingAttack</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InternalAuthenticationServiceException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalAuthenticationServiceException</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="preparetimingattackprotection-å’Œmitigateagainsttimingattack-authentication"><a href="#preparetimingattackprotection-å’Œmitigateagainsttimingattack-authentication" class="header-anchor">#</a> prepareTimingAttackProtection()å’ŒmitigateAgainstTimingAttack(authentication)</h3> <p>ç”¨äºå¹²æ‰°è®¡æ—¶æ”»å‡»ï¼Œé˜²æ­¢é€šè¿‡ååº”æ—¶é—´é•¿çŸ­æ¥åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å­˜åœ¨</p> <p>è®¡æ—¶æ”»å‡»ï¼šå¯†ç åŒ¹é…éœ€è¦ä¸€ä¸ªæ˜æ˜¾çš„è€—æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è€—æ—¶é•¿çŸ­æ¥å¾—åˆ°ä¸€äº›æµ‹è¯•ä¿¡æ¯ã€‚</p> <h3 id="æµç¨‹-2"><a href="#æµç¨‹-2" class="header-anchor">#</a> æµç¨‹</h3> <p>å…ˆä»ç¼“å­˜ä¸­è·å–ï¼Œå¦‚æœè·å–ä¸åˆ°å°±è°ƒç”¨retrieveUseræ–¹æ³•è·å–ï¼Œç„¶åè¿›è¡Œä¸€ç³»åˆ—æ£€éªŒï¼Œæœ€ååŒ…è£…ä¸ºcreateSuccessAuthenticationå¯¹è±¡è¿”å›</p> <h2 id="usernamepasswordauthenticationfilter"><a href="#usernamepasswordauthenticationfilter" class="header-anchor">#</a> UsernamePasswordAuthenticationFilter</h2> <h3 id="çˆ¶ç±»ä¸ºabstractauthenticationprocessingfilter"><a href="#çˆ¶ç±»ä¸ºabstractauthenticationprocessingfilter" class="header-anchor">#</a> çˆ¶ç±»ä¸ºAbstractAuthenticationProcessingFilter</h3> <p><img src="/Sardinary/assets/img/Untitled10.55140881.png" alt="Untitled"></p> <h3 id="çˆ¶ç±»çš„dofilteræ–¹æ³•"><a href="#çˆ¶ç±»çš„dofilteræ–¹æ³•" class="header-anchor">#</a> çˆ¶ç±»çš„doFilteræ–¹æ³•</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">requiresAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//æ˜¯å¦éœ€è¦è®¤è¯</span>
       chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
	    <span class="token comment">//æ‹¿åˆ°çš„æ˜¯å·²ç»è®¤è¯æˆåŠŸçš„authentication</span>
       <span class="token class-name">Authentication</span> authenticationResult <span class="token operator">=</span> <span class="token number">2</span>ï¸âƒ£<span class="token function">attemptAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>authenticationResult <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// return immediately as subclass has indicated that it hasn't completed</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>sessionStrategy<span class="token punctuation">.</span><span class="token function">onAuthentication</span><span class="token punctuation">(</span>authenticationResult<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// Authentication success</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>continueChainBeforeSuccessfulAuthentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//ç»§ç»­è°ƒç”¨è¿‡æ»¤å™¨</span>
       <span class="token punctuation">}</span>
	    <span class="token comment">//1ï¸âƒ£successfulAuthenticationä¸­ä¼šè°ƒç”¨successHandlerï¼Œå³è‡ªå®šä¹‰è®¤è¯æˆåŠŸçš„å¤„ç†é€»è¾‘</span>
       <span class="token function">successfulAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> chain<span class="token punctuation">,</span> authenticationResult<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InternalAuthenticationServiceException</span> failed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;An internal error occurred while trying to authenticate the user.&quot;</span><span class="token punctuation">,</span> failed<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//ç™»å½•å¤±è´¥è°ƒç”¨failureHandler</span>
       <span class="token function">unsuccessfulAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> failed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// Authentication failed</span>
       <span class="token function">unsuccessfulAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_1ï¸âƒ£successfulauthentication"><a href="#_1ï¸âƒ£successfulauthentication" class="header-anchor">#</a> 1ï¸âƒ£successfulAuthentication</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">successfulAuthentication</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authResult<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
    <span class="token class-name">SecurityContext</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>securityContextHolderStrategy<span class="token punctuation">.</span><span class="token function">createEmptyContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>securityContextHolderStrategy<span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>securityContextRepository<span class="token punctuation">.</span><span class="token function">saveContext</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Set SecurityContextHolder to %s&quot;</span><span class="token punctuation">,</span> authResult<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rememberMeServices<span class="token punctuation">.</span><span class="token function">loginSuccess</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> authResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å‘å¸ƒäº‹ä»¶</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventPublisher <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>eventPublisher<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InteractiveAuthenticationSuccessEvent</span><span class="token punctuation">(</span>authResult<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//è°ƒç”¨successHandlerï¼Œå³è‡ªå®šä¹‰è®¤è¯æˆåŠŸçš„å¤„ç†é€»è¾‘</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>successHandler<span class="token punctuation">.</span><span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> authResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_2ï¸âƒ£attemptauthentication"><a href="#_2ï¸âƒ£attemptauthentication" class="header-anchor">#</a> 2ï¸âƒ£attemptAuthentication</h3> <blockquote><p>requestè¿›æ¥ -&gt; åŒ…è£…ä¸ºUsernamePasswordAuthenticationToken -&gt; ä¼ ç»™AuthenticationManagerè¿›è¡Œè®¤è¯</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Authentication</span> <span class="token function">attemptAuthentication</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>
       <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>postOnly <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationServiceException</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication method not supported: &quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token function">obtainUsername</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    username <span class="token operator">=</span> <span class="token punctuation">(</span>username <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> username<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token function">obtainPassword</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    password <span class="token operator">=</span> <span class="token punctuation">(</span>password <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> password <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ‹¿åˆ°usernameå’Œpasswordä¹‹åï¼Œå°è£…UsernamePasswordAuthenticationToken</span>
    <span class="token class-name">UsernamePasswordAuthenticationToken</span> authRequest <span class="token operator">=</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">.</span><span class="token function">unauthenticated</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>
          password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Allow subclasses to set the &quot;details&quot; property</span>
    <span class="token comment">//detailsï¼šå­˜å‚¨ä¸€äº›é¢å¤–çš„ä¿¡æ¯</span>
    <span class="token function">setDetails</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> authRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAuthenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="æ›´æ”¹usernameparameterå’Œpasswordparameter"><a href="#æ›´æ”¹usernameparameterå’Œpasswordparameter" class="header-anchor">#</a> æ›´æ”¹usernameParameterå’ŒpasswordParameter</h3> <p>åœ¨UsernamePasswordAuthenticationFilterä¸­è§„å®šäº†</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SPRING_SECURITY_FORM_USERNAME_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SPRING_SECURITY_FORM_PASSWORD_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token class-name">String</span> usernameParameter <span class="token operator">=</span> <span class="token constant">SPRING_SECURITY_FORM_USERNAME_KEY</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token class-name">String</span> passwordParameter <span class="token operator">=</span> <span class="token constant">SPRING_SECURITY_FORM_PASSWORD_KEY</span><span class="token punctuation">;</span>

</code></pre></div><p>æ›´æ”¹æ–¹æ³•ï¼š</p> <p>å¯ä»¥åœ¨æˆ‘ä»¬å†™çš„configç±»ä¸­è‡ªå®šä¹‰ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">DefaultSecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre></div><p>åŸå› ï¼šformLogin()æä¾›äº†ä¸€ä¸ª<a href="https://sardinary.vercel.app/spring/spring-security-01/#form-login-configurer" target="_blank" rel="noopener noreferrer">FormLoginConfigurer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">FormLoginConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpSecurity</span><span class="token punctuation">&gt;</span></span> <span class="token function">formlogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">getOrApply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FormLoginConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="formloginconfigurer"><a href="#formloginconfigurer" class="header-anchor">#</a> FormLoginConfigurer</h2> <p><img src="/Sardinary/assets/img/Untitled11.1133f72a.png" alt="Untitled"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">FormLoginConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">H</span> <span class="token keyword">extends</span> <span class="token class-name">HttpSecurityBuilder</span><span class="token punctuation">&lt;</span><span class="token class-name">H</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAuthenticationFilterConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">H</span><span class="token punctuation">,</span> <span class="token class-name">FormLoginConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">H</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token class-name">FormLoginConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç™»å½•é¡µé¢</span>
     <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FormLoginConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">H</span><span class="token punctuation">&gt;</span></span> <span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token class-name">String</span> loginPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span>loginPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">FormLoginConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">H</span><span class="token punctuation">&gt;</span></span> <span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token class-name">String</span> usernameParameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">getAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUsernameParameter</span><span class="token punctuation">(</span>usernameParameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">FormLoginConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">H</span><span class="token punctuation">&gt;</span></span> <span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token class-name">String</span> passwordParameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">getAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPasswordParameter</span><span class="token punctuation">(</span>passwordParameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">//å¤±è´¥é‡å®šå‘</span>
    <span class="token keyword">public</span> <span class="token class-name">FormLoginConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">H</span><span class="token punctuation">&gt;</span></span> <span class="token function">failureForwardUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> forwardUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ForwardAuthenticationFailureHandler</span><span class="token punctuation">(</span>forwardUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">FormLoginConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">H</span><span class="token punctuation">&gt;</span></span> <span class="token function">successForwardUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> forwardUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ForwardAuthenticationSuccessHandler</span><span class="token punctuation">(</span>forwardUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">H</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">initDefaultLoginFilter</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">RequestMatcher</span> <span class="token function">createLoginProcessingUrlMatcher</span><span class="token punctuation">(</span><span class="token class-name">String</span> loginProcessingUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span>loginProcessingUrl<span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getUsernameParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token function">getAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUsernameParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getPasswordParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token function">getAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPasswordParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">//åœ¨initæ–¹æ³•ä¸­è¢«è°ƒç”¨</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initDefaultLoginFilter</span><span class="token punctuation">(</span><span class="token class-name">H</span> http<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">DefaultLoginPageGeneratingFilter</span> loginPageGeneratingFilter <span class="token operator">=</span> http
          <span class="token punctuation">.</span><span class="token function">getSharedObject</span><span class="token punctuation">(</span><span class="token class-name">DefaultLoginPageGeneratingFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>loginPageGeneratingFilter <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isCustomLoginPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          loginPageGeneratingFilter<span class="token punctuation">.</span><span class="token function">setFormLoginEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          loginPageGeneratingFilter<span class="token punctuation">.</span><span class="token function">setUsernameParameter</span><span class="token punctuation">(</span><span class="token function">getUsernameParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          loginPageGeneratingFilter<span class="token punctuation">.</span><span class="token function">setPasswordParameter</span><span class="token punctuation">(</span><span class="token function">getPasswordParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          loginPageGeneratingFilter<span class="token punctuation">.</span><span class="token function">setLoginPageUrl</span><span class="token punctuation">(</span><span class="token function">getLoginPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          loginPageGeneratingFilter<span class="token punctuation">.</span><span class="token function">setFailureUrl</span><span class="token punctuation">(</span><span class="token function">getFailureUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          loginPageGeneratingFilter<span class="token punctuation">.</span><span class="token function">setAuthenticationUrl</span><span class="token punctuation">(</span><span class="token function">getLoginProcessingUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="çˆ¶ç±»securityconfigureradapter"><a href="#çˆ¶ç±»securityconfigureradapter" class="header-anchor">#</a> çˆ¶ç±»SecurityConfigurerAdapter</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfigurerAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">SecurityBuilder</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">SecurityConfigurer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">B</span> securityBuilder<span class="token punctuation">;</span>

	<span class="token comment">//å±äºconfigurerçš„objectPostProcessorï¼Œå’ŒsecurityBuilderä¸­çš„objectPostProcessorä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ä½œç”¨ç›¸ä¼¼</span>
    <span class="token keyword">private</span> <span class="token class-name">CompositeObjectPostProcessor</span> objectPostProcessor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompositeObjectPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">B</span> builder<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">B</span> builder<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//è¿”å›builderï¼Œå¯ä»¥è¾¾åˆ°é“¾å¼è°ƒç”¨çš„æ•ˆæœ</span>
    <span class="token keyword">public</span> <span class="token class-name">B</span> <span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token function">getBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">B</span> <span class="token function">getBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>securityBuilder <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;securityBuilder cannot be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>securityBuilder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">postProcess</span><span class="token punctuation">(</span><span class="token class-name">T</span> object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>objectPostProcessor<span class="token punctuation">.</span><span class="token function">postProcess</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addObjectPostProcessor</span><span class="token punctuation">(</span><span class="token class-name">ObjectPostProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> objectPostProcessor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>objectPostProcessor<span class="token punctuation">.</span><span class="token function">addObjectPostProcessor</span><span class="token punctuation">(</span>objectPostProcessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBuilder</span><span class="token punctuation">(</span><span class="token class-name">B</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>securityBuilder <span class="token operator">=</span> builder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">CompositeObjectPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">ObjectPostProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
		<span class="token comment">//å¯ä»¥ç»´æŠ¤å¤šä¸ªpostProcessor</span>
       <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ObjectPostProcessor</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> postProcessors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token annotation punctuation">@Override</span>
       <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;rawtypes&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;unchecked&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token comment">//é€ä¸ªè°ƒç”¨</span>
       <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcess</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ObjectPostProcessor</span> opp <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>postProcessors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> oppClass <span class="token operator">=</span> opp<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> oppType <span class="token operator">=</span> <span class="token class-name">GenericTypeResolver</span><span class="token punctuation">.</span><span class="token function">resolveTypeArgument</span><span class="token punctuation">(</span>oppClass<span class="token punctuation">,</span> <span class="token class-name">ObjectPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>oppType <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> oppType<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                object <span class="token operator">=</span> opp<span class="token punctuation">.</span><span class="token function">postProcess</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> object<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

		<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">addObjectPostProcessor</span><span class="token punctuation">(</span><span class="token class-name">ObjectPostProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> objectPostProcessor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		    <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>postProcessors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>objectPostProcessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token keyword">this</span><span class="token punctuation">.</span>postProcessors<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h3 id="çˆ¶ç±»abstracthttpconfigurer"><a href="#çˆ¶ç±»abstracthttpconfigurer" class="header-anchor">#</a> çˆ¶ç±»AbstractHttpConfigurer</h3> <h3 id="disable"><a href="#disable" class="header-anchor">#</a> disable</h3> <p>ç§»é™¤Configurer</p> <div class="language- extra-class"><pre class="language-text"><code>public B disable() {
    getBuilder().removeConfigurer(getClass());
    return getBuilder();
}

</code></pre></div><p>removeConfigureræ–¹æ³•åœ¨æ¥å£HttpSecurityBuilderä¸­å£°æ˜ï¼Œåœ¨<a href="https://sardinary.vercel.app/spring/spring-security-01/#abstract-configured-security-builder" target="_blank" rel="noopener noreferrer">AbstractConfiguredSecurityBuilder<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸­å®ç°</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">C</span> <span class="token keyword">extends</span> <span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">C</span> <span class="token function">removeConfigurer</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">C</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityConfigurer</span><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> configs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>configs <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">removeFromConfigurersAddedInInitializing</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>configs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Only one configurer expected for type &quot;</span> <span class="token operator">+</span> clazz <span class="token operator">+</span> <span class="token string">&quot;, but got &quot;</span> <span class="token operator">+</span> configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">C</span><span class="token punctuation">)</span> configs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="withobjectpostprocessor"><a href="#withobjectpostprocessor" class="header-anchor">#</a> withObjectPostProcessor</h3> <p>æ·»åŠ ä¸€ä¸ªobjectPostProcessor</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">withObjectPostProcessor</span><span class="token punctuation">(</span><span class="token class-name">ObjectPostProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> objectPostProcessor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">addObjectPostProcessor</span><span class="token punctuation">(</span>objectPostProcessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="çˆ¶ç±»abstractauthenticationfilterconfigurer"><a href="#çˆ¶ç±»abstractauthenticationfilterconfigurer" class="header-anchor">#</a> çˆ¶ç±»AbstractAuthenticationFilterConfigurer</h3> <p>å®ç°äº†<a href="https://sardinary.vercel.app/spring/spring-security-01/#security-configurer" target="_blank" rel="noopener noreferrer">SecurityConfigurer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œå› æ­¤å®ç°äº†initæ–¹æ³•å’Œconfigureæ–¹æ³•</p> <h3 id="init"><a href="#init" class="header-anchor">#</a> init</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">B</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token comment">//æ³¨å†Œä¸€äº›é»˜è®¤å±æ€§</span>
    <span class="token function">updateAuthenticationDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">updateAccessDefaults</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">registerDefaultAuthenticationEntryPoint</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="configure"><a href="#configure" class="header-anchor">#</a> Configure</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">B</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">PortMapper</span> portMapper <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">getSharedObject</span><span class="token punctuation">(</span><span class="token class-name">PortMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>portMapper <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>authenticationEntryPoint<span class="token punctuation">.</span><span class="token function">setPortMapper</span><span class="token punctuation">(</span>portMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ‹¿å‡ºå…±äº«å¯¹è±¡ï¼Œå¾—åˆ°è¯·æ±‚çš„ç¼“å­˜å™¨</span>
    <span class="token class-name">RequestCache</span> requestCache <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">getSharedObject</span><span class="token punctuation">(</span><span class="token class-name">RequestCache</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCache <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//1ï¸âƒ£</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>defaultSuccessHandler<span class="token punctuation">.</span><span class="token function">setRequestCache</span><span class="token punctuation">(</span>requestCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>authFilter<span class="token punctuation">.</span><span class="token function">setAuthenticationManager</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">getSharedObject</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>authFilter<span class="token punctuation">.</span><span class="token function">setAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>successHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>authFilter<span class="token punctuation">.</span><span class="token function">setAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>failureHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>authenticationDetailsSource <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>authFilter<span class="token punctuation">.</span><span class="token function">setAuthenticationDetailsSource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>authenticationDetailsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">SessionAuthenticationStrategy</span> sessionAuthenticationStrategy <span class="token operator">=</span> http
       <span class="token punctuation">.</span><span class="token function">getSharedObject</span><span class="token punctuation">(</span><span class="token class-name">SessionAuthenticationStrategy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sessionAuthenticationStrategy <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>authFilter<span class="token punctuation">.</span><span class="token function">setSessionAuthenticationStrategy</span><span class="token punctuation">(</span>sessionAuthenticationStrategy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">RememberMeServices</span> rememberMeServices <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">getSharedObject</span><span class="token punctuation">(</span><span class="token class-name">RememberMeServices</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rememberMeServices <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>authFilter<span class="token punctuation">.</span><span class="token function">setRememberMeServices</span><span class="token punctuation">(</span>rememberMeServices<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//è®¾ç½®å®‰å…¨ä¸Šä¸‹æ–‡</span>
    <span class="token class-name">SecurityContextConfigurer</span> securityContextConfigurer <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">getConfigurer</span><span class="token punctuation">(</span><span class="token class-name">SecurityContextConfigurer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>securityContextConfigurer <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> securityContextConfigurer<span class="token punctuation">.</span><span class="token function">isRequireExplicitSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">SecurityContextRepository</span> securityContextRepository <span class="token operator">=</span> securityContextConfigurer
          <span class="token punctuation">.</span><span class="token function">getSecurityContextRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>authFilter<span class="token punctuation">.</span><span class="token function">setSecurityContextRepository</span><span class="token punctuation">(</span>securityContextRepository<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>authFilter<span class="token punctuation">.</span><span class="token function">setSecurityContextHolderStrategy</span><span class="token punctuation">(</span><span class="token function">getSecurityContextHolderStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">F</span> filter <span class="token operator">=</span> <span class="token function">postProcess</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>authFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//2ï¸âƒ£</span>
    <span class="token comment">//æ·»åŠ filter</span>
    http<span class="token punctuation">.</span><span class="token function">addFilter</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//3ï¸âƒ£</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_1ï¸âƒ£this-defaultsuccesshandler-setrequestcache-requestcache"><a href="#_1ï¸âƒ£this-defaultsuccesshandler-setrequestcache-requestcache" class="header-anchor">#</a> 1ï¸âƒ£this.defaultSuccessHandler.setRequestCache(requestCache)</h3> <p>ä¿å­˜ç”¨æˆ·ç™»å½•å¤±è´¥å‰çš„é¡µé¢ï¼Œä¸‹æ¬¡ç™»å½•æˆåŠŸåé»˜è®¤æ‰“å¼€ä¸Šæ¬¡ç™»å½•çš„æœ€åé¡µé¢ï¼ˆå³ä¿å­˜çš„é¡µé¢ï¼‰ï¼Œç”¨æˆ·ä½“éªŒå¥½</p> <h3 id="_2ï¸âƒ£postprocess-this-authfilter"><a href="#_2ï¸âƒ£postprocess-this-authfilter" class="header-anchor">#</a> 2ï¸âƒ£postProcess(this.authFilter)</h3> <h3 id="å¯ä»¥åœ¨æˆ‘ä»¬é…ç½®çš„configç±»è‡ªå®šä¹‰postprocesser"><a href="#å¯ä»¥åœ¨æˆ‘ä»¬é…ç½®çš„configç±»è‡ªå®šä¹‰postprocesser" class="header-anchor">#</a> å¯ä»¥åœ¨æˆ‘ä»¬é…ç½®çš„configç±»è‡ªå®šä¹‰postProcesser</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">DefaultSecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">withObjectPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">addObjectPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre></div><p>åœ¨...å¤„newä¸€ä¸ªè‡ªå·±çš„objectPostProcessorï¼ŒinstanceofæŸä¸€ä¸ªfilter</p> <h3 id="this-authfilteræ³¨å…¥çš„æ—¶æœº"><a href="#this-authfilteræ³¨å…¥çš„æ—¶æœº" class="header-anchor">#</a> this.authFilteræ³¨å…¥çš„æ—¶æœº</h3> <div class="language- extra-class"><pre class="language-text"><code>protected final void setAuthenticationFilter(F authFilter) {
    this.authFilter = authFilter;
}

</code></pre></div><p>å…¶ä¸­setAuthenticationFilterè¢«è°ƒç”¨çš„æ—¶æœºä¸ºï¼š</p> <blockquote><p>åœ¨å­ç±»ä¸­è¢«è°ƒç”¨ã€‚</p> <p>ä¾‹å¦‚å­ç±»FormLoginConfigurer</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">FormLoginConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>å…¶ä¸­superçš„æ„é€ æ–¹æ³•</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">AbstractAuthenticationFilterConfigurer</span><span class="token punctuation">(</span><span class="token class-name">F</span> authenticationFilter<span class="token punctuation">,</span> <span class="token class-name">String</span> defaultLoginProcessingUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>authFilter <span class="token operator">=</span> authenticationFilter<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultLoginProcessingUrl <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span>defaultLoginProcessingUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_3ï¸âƒ£addfilter"><a href="#_3ï¸âƒ£addfilter" class="header-anchor">#</a> 3ï¸âƒ£addFilter</h3> <p>HttpSecurityBuilderæ¥å£ä¸­å£°æ˜ï¼Œ<a href="https://sardinary.vercel.app/spring/spring-security-01/#http-security" target="_blank" rel="noopener noreferrer">HttpSecurity<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸­å®ç°</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">HttpSecurity</span> <span class="token function">addFilter</span><span class="token punctuation">(</span><span class="token class-name">Filter</span> filter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Integer</span> order <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filterOrders<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span>filter<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;The Filter class &quot;</span> <span class="token operator">+</span> filter<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
             <span class="token operator">+</span> <span class="token string">&quot; does not have a registered order and cannot be added without a specified order. Consider using addFilterBefore or addFilterAfter instead.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OrderedFilter</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="åŒ¿åç™»å½•"><a href="#åŒ¿åç™»å½•" class="header-anchor">#</a> åŒ¿åç™»å½•</h2> <blockquote><p>ç™»å½•æˆåŠŸåï¼Œé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ç”±SecurityPropertiesç±»ä¸­çš„Userç±»ä¸­çš„å±æ€§ç¡®å®š</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>private String name = &quot;user&quot;;
private String password = UUID.randomUUID().toString();

</code></pre></div><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ä¼šæ‰§è¡ŒUserDetailsServiceAutoConfigurationç±»ä¸­çš„ï¼š</p></blockquote> <ul><li>inMemoryUserDetailsManageræ–¹æ³•</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">InMemoryUserDetailsManager</span> <span class="token function">inMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token class-name">SecurityProperties</span> properties<span class="token punctuation">,</span> <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PasswordEncoder</span><span class="token punctuation">&gt;</span></span> passwordEncoder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SecurityProperties<span class="token punctuation">.</span>User</span> user <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserDetails</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOrDeducePassword</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">PasswordEncoder</span><span class="token punctuation">)</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">getIfAvailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>InMemoryUserDetailsManagerç±»</p> <p><img src="/Sardinary/assets/img/Untitled12.4b248751.png" alt="Untitled"></p> <ul><li>getOrDeducePasswordæ–¹æ³•</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getOrDeducePassword</span><span class="token punctuation">(</span><span class="token class-name">SecurityProperties<span class="token punctuation">.</span>User</span> user<span class="token punctuation">,</span> <span class="token class-name">PasswordEncoder</span> encoder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">isPasswordGenerated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%n%nUsing generated security password: %s%n%nThis generated password is for development use only. Your security configuration must be updated before running your application in production.%n&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> encoder <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token constant">PASSWORD_ALGORITHM_PATTERN</span><span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;{noop}&quot;</span> <span class="token operator">+</span> password <span class="token operator">:</span> password<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="ç™»å½•è¿‡ç¨‹"><a href="#ç™»å½•è¿‡ç¨‹" class="header-anchor">#</a> ç™»å½•è¿‡ç¨‹</h3> <p>è¿›å…¥<a href="https://sardinary.vercel.app/spring/spring-security-01/#abstract-authentication-processing-filter" target="_blank" rel="noopener noreferrer">AbstractAuthenticationProcessingFilter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„<a href="https://sardinary.vercel.app/spring/spring-security-01/#do-filter" target="_blank" rel="noopener noreferrer">doFilter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ–¹æ³•</p> <p>å‰ç«¯ç™»å½•æˆåŠŸåä¼šè°ƒç”¨<a href="https://sardinary.vercel.app/spring/spring-security-01/#username-password-authentication-filter" target="_blank" rel="noopener noreferrer">UsernamePasswordAuthenticationFilter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„<a href="https://sardinary.vercel.app/spring/spring-security-01/#2-attempt-authentication" target="_blank" rel="noopener noreferrer">attemptAuthentication<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ–¹æ³•</p> <p>å…¶ä¸­çš„this.getAuthenticationManager()æ˜¯ä¸€ä¸ªproviderManagerï¼Œä½†æ˜¯è¯¥providerManageçš„providerså±æ€§ä¸­åªæœ‰ä¸€ä¸ªAnonymousAuthenticationProviderï¼›è€Œè¯¥providerManageçš„parentå±æ€§ä¸­çš„providersä¸­æœ‰<a href="https://sardinary.vercel.app/spring/spring-security-01/#dao-authentication-provider" target="_blank" rel="noopener noreferrer">DaoAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ç„¶åæ‰§è¡Œ<a href="https://sardinary.vercel.app/spring/spring-security-01/#provider-manager" target="_blank" rel="noopener noreferrer">ProviderManager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„authenticateæ–¹æ³•ï¼Œåœ¨åˆ¤æ–­å­ç±»provideræ˜¯å¦æ”¯æŒçš„æ—¶å€™å‘ç°å­ç±»çš„å”¯ä¸€çš„AnonymousAuthenticationProviderä¸æ”¯æŒï¼Œç„¶åè°ƒç”¨çˆ¶ç±»çš„providerï¼Œå‘ç°æ”¯æŒ<a href="https://sardinary.vercel.app/spring/spring-security-01/#dao-authentication-provider" target="_blank" rel="noopener noreferrer">DaoAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ç„¶åæ‰§è¡Œprovider.<a href="https://sardinary.vercel.app/spring/spring-security-01/#authenticate" target="_blank" rel="noopener noreferrer">authenticate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ–¹æ³•ï¼Œè¿›å…¥<a href="https://sardinary.vercel.app/spring/spring-security-01/#abstract-user-details-authentication-provider" target="_blank" rel="noopener noreferrer">AbstractUserDetailsAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ç±»</p> <p>ç„¶åè¿›å…¥æ‰§è¡Œ<a href="https://sardinary.vercel.app/spring/spring-security-01/#6-retrieve-user" target="_blank" rel="noopener noreferrer">retrieveUser<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ–¹æ³•ï¼Œè¿›å…¥<a href="https://sardinary.vercel.app/spring/spring-security-01/#dao-authentication-provider" target="_blank" rel="noopener noreferrer">DaoAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ç±»ï¼Œ</p> <p>å…¶ä¸­çš„this.getUserDetailsServiceä¸ºinMemoryUserDetailsManager</p> <p>æ‰§è¡Œåˆ°<a href="https://sardinary.vercel.app/spring/spring-security-01/#abstract-user-details-authentication-provider" target="_blank" rel="noopener noreferrer">AbstractUserDetailsAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„<a href="https://sardinary.vercel.app/spring/spring-security-01/#authenticate" target="_blank" rel="noopener noreferrer">authenticate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ–¹æ³•çš„return createSuccessAuthenticationè¯­å¥æ—¶</p> <p>æ‰§è¡Œæ–¹æ³•createSuccessAuthenticationï¼Œè¿›å…¥<a href="https://sardinary.vercel.app/spring/spring-security-01/#dao-authentication-provider" target="_blank" rel="noopener noreferrer">DaoAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ç±»</p> <p>æ‰§è¡Œåˆ°return super.createSuccessAuthenticationçš„æ—¶å€™</p> <p>è¿›å…¥çˆ¶ç±»<a href="https://sardinary.vercel.app/spring/spring-security-01/#abstract-user-details-authentication-provider" target="_blank" rel="noopener noreferrer">AbstractUserDetailsAuthenticationProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„<a href="https://sardinary.vercel.app/spring/spring-security-01/#5-create-success-authentication" target="_blank" rel="noopener noreferrer">createSuccessAuthentication<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ–¹æ³•</p> <p>æ‰§è¡ŒUsernamePasswordAuthenticationToken.authenticatedæ–¹æ³•å¾—åˆ°UsernamePasswordAuthenticationToken</p> <p><em>......ä¸€ç³»åˆ—è¿”å›</em></p> <p>æ‰§è¡Œå®ŒattemptAuthenticationæ–¹æ³•ï¼Œè¿”å›è®¤è¯æˆåŠŸçš„<a href="https://sardinary.vercel.app/spring/spring-security-01/#authentication" target="_blank" rel="noopener noreferrer">Authentication<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>åˆ°<a href="https://sardinary.vercel.app/spring/spring-security-01/#abstract-authentication-processing-filter" target="_blank" rel="noopener noreferrer">AbstractAuthenticationProcessingFilter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œç»§ç»­å®Œæˆ<a href="https://sardinary.vercel.app/spring/spring-security-01/#do-filter" target="_blank" rel="noopener noreferrer">doFilter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ–¹æ³•</p> <p>è°ƒç”¨successfulAuthenticationæ–¹æ³•</p> <p>è°ƒç”¨onAuthenticationSuccessæ–¹æ³•ï¼Œè¿›å…¥SavedRequestAwareAuthenticationSuccessHandlerç±»ï¼Œè¿›è¡Œé‡å®šå‘</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#å¼•å…¥" class="sidebar-link reco-side-å¼•å…¥" data-v-b57cc07c>å¼•å…¥</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#httpsecurity" class="sidebar-link reco-side-httpsecurity" data-v-b57cc07c>HttpSecurity</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#securityfilterchain" class="sidebar-link reco-side-securityfilterchain" data-v-b57cc07c>SecurityFilterChain</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#å®ç°ç±»defaultsecurityfilterchain" class="sidebar-link reco-side-å®ç°ç±»defaultsecurityfilterchain" data-v-b57cc07c>å®ç°ç±»DefaultSecurityFilterChain</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#websecurity" class="sidebar-link reco-side-websecurity" data-v-b57cc07c>WebSecurity</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#securitybuilderçš„buildæ–¹æ³•-dobuildæ–¹æ³•" class="sidebar-link reco-side-securitybuilderçš„buildæ–¹æ³•-dobuildæ–¹æ³•" data-v-b57cc07c>SecurityBuilderçš„buildæ–¹æ³• -&gt; doBuildæ–¹æ³•</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#filterchainproxy" class="sidebar-link reco-side-filterchainproxy" data-v-b57cc07c>FilterChainProxy</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#springsecurityæµç¨‹" class="sidebar-link reco-side-springsecurityæµç¨‹" data-v-b57cc07c>SpringSecurityæµç¨‹</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#httpsecurityå’Œwebsecurityçš„é…ç½®" class="sidebar-link reco-side-httpsecurityå’Œwebsecurityçš„é…ç½®" data-v-b57cc07c>HttpSecurityå’ŒWebSecurityçš„é…ç½®</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#securityconfigurer" class="sidebar-link reco-side-securityconfigurer" data-v-b57cc07c>SecurityConfigurer</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#abstractconfiguredsecuritybuilder" class="sidebar-link reco-side-abstractconfiguredsecuritybuilder" data-v-b57cc07c>AbstractConfiguredSecurityBuilder</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_4ï¸âƒ£init" class="sidebar-link reco-side-_4ï¸âƒ£init" data-v-b57cc07c>4ï¸âƒ£init()</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#collection-securityconfigurer-o-b-configurers-2ï¸âƒ£getconfigurers-ä½œç”¨" class="sidebar-link reco-side-collection-securityconfigurer-o-b-configurers-2ï¸âƒ£getconfigurers-ä½œç”¨" data-v-b57cc07c>Collection configurers = 2ï¸âƒ£getConfigurers()ä½œç”¨ï¼š</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#for-securityconfigurer-o-b-configurer-this-configurersaddedininitializing-ä½œç”¨" class="sidebar-link reco-side-for-securityconfigurer-o-b-configurer-this-configurersaddedininitializing-ä½œç”¨" data-v-b57cc07c>for (SecurityConfigurer configurer : this.configurersAddedInInitializing)ä½œç”¨ï¼š</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_5ï¸âƒ£beforeconfigure" class="sidebar-link reco-side-_5ï¸âƒ£beforeconfigure" data-v-b57cc07c>5ï¸âƒ£beforeConfigure()</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_1ï¸âƒ£buildstate" class="sidebar-link reco-side-_1ï¸âƒ£buildstate" data-v-b57cc07c>1ï¸âƒ£BuildState</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#httpsecurity-2" class="sidebar-link reco-side-httpsecurity-2" data-v-b57cc07c>HttpSecurity</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_7ï¸âƒ£httpsecurityå¯¹performbuild-æ–¹æ³•çš„å®ç°" class="sidebar-link reco-side-_7ï¸âƒ£httpsecurityå¯¹performbuild-æ–¹æ³•çš„å®ç°" data-v-b57cc07c>7ï¸âƒ£HttpSecurityå¯¹performBuild()æ–¹æ³•çš„å®ç°</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#authentication" class="sidebar-link reco-side-authentication" data-v-b57cc07c>Authentication</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#authenticationmanager" class="sidebar-link reco-side-authenticationmanager" data-v-b57cc07c>AuthenticationManager</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#authenticationmanagerbuilder" class="sidebar-link reco-side-authenticationmanagerbuilder" data-v-b57cc07c>AuthenticationManagerBuilder</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#å±æ€§" class="sidebar-link reco-side-å±æ€§" data-v-b57cc07c>å±æ€§</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#performbuild" class="sidebar-link reco-side-performbuild" data-v-b57cc07c>performBuild()</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#postprocess-providermanager" class="sidebar-link reco-side-postprocess-providermanager" data-v-b57cc07c>postProcess(providerManager)</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#å±æ€§è®¾ç½®" class="sidebar-link reco-side-å±æ€§è®¾ç½®" data-v-b57cc07c>å±æ€§è®¾ç½®</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#authenticationprovideråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®" class="sidebar-link reco-side-authenticationprovideråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®" data-v-b57cc07c>AuthenticationProvideråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#parentauthenticationmanageråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®" class="sidebar-link reco-side-parentauthenticationmanageråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®" data-v-b57cc07c>parentAuthenticationManageråœ¨è¿™ä¸ªæ„é€ æ–¹æ³•è¢«è®¾ç½®</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#authenticationprovider" class="sidebar-link reco-side-authenticationprovider" data-v-b57cc07c>AuthenticationProvider</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#authenticate-authentication-authentication" class="sidebar-link reco-side-authenticate-authentication-authentication" data-v-b57cc07c>authenticate(Authentication authentication)</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#ç­–ç•¥æ¨¡å¼" class="sidebar-link reco-side-ç­–ç•¥æ¨¡å¼" data-v-b57cc07c>ç­–ç•¥æ¨¡å¼</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#providermanager" class="sidebar-link reco-side-providermanager" data-v-b57cc07c>ProviderManager</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#authenticateæ–¹æ³•" class="sidebar-link reco-side-authenticateæ–¹æ³•" data-v-b57cc07c>authenticateæ–¹æ³•</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#æµç¨‹" class="sidebar-link reco-side-æµç¨‹" data-v-b57cc07c>æµç¨‹</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#æ€»ç»“" class="sidebar-link reco-side-æ€»ç»“" data-v-b57cc07c>æ€»ç»“</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#userdetailsservice" class="sidebar-link reco-side-userdetailsservice" data-v-b57cc07c>UserDetailsService</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#daoauthenticationprovider" class="sidebar-link reco-side-daoauthenticationprovider" data-v-b57cc07c>DaoAuthenticationProvider</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#abstractuserdetailsauthenticationprovider" class="sidebar-link reco-side-abstractuserdetailsauthenticationprovider" data-v-b57cc07c>AbstractUserDetailsAuthenticationProvider</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#ğŸŒŸauthenticateæ–¹æ³•" class="sidebar-link reco-side-ğŸŒŸauthenticateæ–¹æ³•" data-v-b57cc07c>ğŸŒŸauthenticateæ–¹æ³•</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_1ï¸âƒ£determineusername" class="sidebar-link reco-side-_1ï¸âƒ£determineusername" data-v-b57cc07c>1ï¸âƒ£determineUsername</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_2ï¸âƒ£useræ°¸è¿œç­‰äºnull" class="sidebar-link reco-side-_2ï¸âƒ£useræ°¸è¿œç­‰äºnull" data-v-b57cc07c>2ï¸âƒ£useræ°¸è¿œç­‰äºnull</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_3ï¸âƒ£å…³äºéšè—usernotfoundexceptions" class="sidebar-link reco-side-_3ï¸âƒ£å…³äºéšè—usernotfoundexceptions" data-v-b57cc07c>3ï¸âƒ£å…³äºéšè—UserNotFoundExceptions</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_4ï¸âƒ£å¦‚æœæ•è·åˆ°äº†authenticationexception" class="sidebar-link reco-side-_4ï¸âƒ£å¦‚æœæ•è·åˆ°äº†authenticationexception" data-v-b57cc07c>4ï¸âƒ£å¦‚æœæ•è·åˆ°äº†AuthenticationException</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#å…³äºæ ¡éªŒ" class="sidebar-link reco-side-å…³äºæ ¡éªŒ" data-v-b57cc07c>å…³äºæ ¡éªŒ</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#userdetailschecker" class="sidebar-link reco-side-userdetailschecker" data-v-b57cc07c>UserDetailsChecker</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#defaultpreauthenticationchecks" class="sidebar-link reco-side-defaultpreauthenticationchecks" data-v-b57cc07c>DefaultPreAuthenticationChecks</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#defaultpostauthenticationchecks" class="sidebar-link reco-side-defaultpostauthenticationchecks" data-v-b57cc07c>DefaultPostAuthenticationChecks</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#additionalauthenticationchecks" class="sidebar-link reco-side-additionalauthenticationchecks" data-v-b57cc07c>additionalAuthenticationChecks</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_5ï¸âƒ£createsuccessauthentication" class="sidebar-link reco-side-_5ï¸âƒ£createsuccessauthentication" data-v-b57cc07c>5ï¸âƒ£createSuccessAuthentication</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#authoritiesmapper" class="sidebar-link reco-side-authoritiesmapper" data-v-b57cc07c>authoritiesMapper</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#daoauthenticationproviderä¸­çš„createsuccessauthentication" class="sidebar-link reco-side-daoauthenticationproviderä¸­çš„createsuccessauthentication" data-v-b57cc07c>DaoAuthenticationProviderä¸­çš„createSuccessAuthentication</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#userdetailspasswordservice" class="sidebar-link reco-side-userdetailspasswordservice" data-v-b57cc07c>userDetailsPasswordService</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_6ï¸âƒ£retrieveuserğŸŒŸ" class="sidebar-link reco-side-_6ï¸âƒ£retrieveuserğŸŒŸ" data-v-b57cc07c>6ï¸âƒ£retrieveUserğŸŒŸ</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#åœ¨daoauthenticationproviderä¸­å”¯ä¸€å®ç°" class="sidebar-link reco-side-åœ¨daoauthenticationproviderä¸­å”¯ä¸€å®ç°" data-v-b57cc07c>åœ¨DaoAuthenticationProviderä¸­å”¯ä¸€å®ç°</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#preparetimingattackprotection-å’Œmitigateagainsttimingattack-authentication" class="sidebar-link reco-side-preparetimingattackprotection-å’Œmitigateagainsttimingattack-authentication" data-v-b57cc07c>prepareTimingAttackProtection()å’ŒmitigateAgainstTimingAttack(authentication)</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#æµç¨‹-2" class="sidebar-link reco-side-æµç¨‹-2" data-v-b57cc07c>æµç¨‹</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#usernamepasswordauthenticationfilter" class="sidebar-link reco-side-usernamepasswordauthenticationfilter" data-v-b57cc07c>UsernamePasswordAuthenticationFilter</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#çˆ¶ç±»ä¸ºabstractauthenticationprocessingfilter" class="sidebar-link reco-side-çˆ¶ç±»ä¸ºabstractauthenticationprocessingfilter" data-v-b57cc07c>çˆ¶ç±»ä¸ºAbstractAuthenticationProcessingFilter</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#çˆ¶ç±»çš„dofilteræ–¹æ³•" class="sidebar-link reco-side-çˆ¶ç±»çš„dofilteræ–¹æ³•" data-v-b57cc07c>çˆ¶ç±»çš„doFilteræ–¹æ³•</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_1ï¸âƒ£successfulauthentication" class="sidebar-link reco-side-_1ï¸âƒ£successfulauthentication" data-v-b57cc07c>1ï¸âƒ£successfulAuthentication</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_2ï¸âƒ£attemptauthentication" class="sidebar-link reco-side-_2ï¸âƒ£attemptauthentication" data-v-b57cc07c>2ï¸âƒ£attemptAuthentication</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#æ›´æ”¹usernameparameterå’Œpasswordparameter" class="sidebar-link reco-side-æ›´æ”¹usernameparameterå’Œpasswordparameter" data-v-b57cc07c>æ›´æ”¹usernameParameterå’ŒpasswordParameter</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#formloginconfigurer" class="sidebar-link reco-side-formloginconfigurer" data-v-b57cc07c>FormLoginConfigurer</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#çˆ¶ç±»securityconfigureradapter" class="sidebar-link reco-side-çˆ¶ç±»securityconfigureradapter" data-v-b57cc07c>çˆ¶ç±»SecurityConfigurerAdapter</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#çˆ¶ç±»abstracthttpconfigurer" class="sidebar-link reco-side-çˆ¶ç±»abstracthttpconfigurer" data-v-b57cc07c>çˆ¶ç±»AbstractHttpConfigurer</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#disable" class="sidebar-link reco-side-disable" data-v-b57cc07c>disable</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#withobjectpostprocessor" class="sidebar-link reco-side-withobjectpostprocessor" data-v-b57cc07c>withObjectPostProcessor</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#çˆ¶ç±»abstractauthenticationfilterconfigurer" class="sidebar-link reco-side-çˆ¶ç±»abstractauthenticationfilterconfigurer" data-v-b57cc07c>çˆ¶ç±»AbstractAuthenticationFilterConfigurer</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#init" class="sidebar-link reco-side-init" data-v-b57cc07c>init</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#configure" class="sidebar-link reco-side-configure" data-v-b57cc07c>Configure</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_1ï¸âƒ£this-defaultsuccesshandler-setrequestcache-requestcache" class="sidebar-link reco-side-_1ï¸âƒ£this-defaultsuccesshandler-setrequestcache-requestcache" data-v-b57cc07c>1ï¸âƒ£this.defaultSuccessHandler.setRequestCache(requestCache)</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_2ï¸âƒ£postprocess-this-authfilter" class="sidebar-link reco-side-_2ï¸âƒ£postprocess-this-authfilter" data-v-b57cc07c>2ï¸âƒ£postProcess(this.authFilter)</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#å¯ä»¥åœ¨æˆ‘ä»¬é…ç½®çš„configç±»è‡ªå®šä¹‰postprocesser" class="sidebar-link reco-side-å¯ä»¥åœ¨æˆ‘ä»¬é…ç½®çš„configç±»è‡ªå®šä¹‰postprocesser" data-v-b57cc07c>å¯ä»¥åœ¨æˆ‘ä»¬é…ç½®çš„configç±»è‡ªå®šä¹‰postProcesser</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#this-authfilteræ³¨å…¥çš„æ—¶æœº" class="sidebar-link reco-side-this-authfilteræ³¨å…¥çš„æ—¶æœº" data-v-b57cc07c>this.authFilteræ³¨å…¥çš„æ—¶æœº</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#_3ï¸âƒ£addfilter" class="sidebar-link reco-side-_3ï¸âƒ£addfilter" data-v-b57cc07c>3ï¸âƒ£addFilter</a></li><li class="level-2" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#åŒ¿åç™»å½•" class="sidebar-link reco-side-åŒ¿åç™»å½•" data-v-b57cc07c>åŒ¿åç™»å½•</a></li><li class="level-3" data-v-b57cc07c><a href="/Sardinary/blogs/SpringSecurity/Spring_Security_01%2043df0f31c1074521b09583c6ba675b1f.html#ç™»å½•è¿‡ç¨‹" class="sidebar-link reco-side-ç™»å½•è¿‡ç¨‹" data-v-b57cc07c>ç™»å½•è¿‡ç¨‹</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="Sakura" data-v-248d85d6><canvas id="canvas_sakura" style="z-index:0;" data-v-248d85d6></canvas></div><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/Sardinary/assets/js/app.b4352b80.js" defer></script><script src="/Sardinary/assets/js/7.1de0e771.js" defer></script><script src="/Sardinary/assets/js/2.32e86603.js" defer></script><script src="/Sardinary/assets/js/1.87af8fda.js" defer></script><script src="/Sardinary/assets/js/19.73412c71.js" defer></script>
  </body>
</html>
